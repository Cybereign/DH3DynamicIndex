<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
    
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .admin-indicator {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .auth-section {
            padding: 15px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .login-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .login-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .login-btn {
            padding: 8px 15px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .login-btn:hover {
            background: #5a0db5;
        }
        
        .logout-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-info {
            font-size: 0.8rem;
            color: #666;
            margin-left: 10px;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }
        
        .filter-box {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 18px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover {
            background: #f0f0f0;
        }
        
        .filter-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db5;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #eaeaea;
            font-size: 0.95rem;
            position: relative;
        }
        
        .editable-header {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .editable-header:hover {
            background: #e9ecef;
        }
        
        .editable-header .edit-icon {
            opacity: 0;
            margin-left: 5px;
            font-size: 0.8rem;
            transition: opacity 0.2s;
        }
        
        .editable-header:hover .edit-icon {
            opacity: 1;
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid #eaeaea;
            font-size: 0.95rem;
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f8f9ff;
        }
        
        .category {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .category-1 { background: #e3f2fd; color: #1976d2; }
        .category-2 { background: #e8f5e9; color: #388e3c; }
        .category-3 { background: #fff3e0; color: #f57c00; }
        .category-4 { background: #fce4ec; color: #c2185b; }
        .category-5 { background: #f3e5f5; color: #7b1fa2; }
        .category-6 { background: #e0f2f1; color: #00796b; }
        .category-7 { background: #fff8e1; color: #ff8f00; }
        .category-8 { background: #fbe9e7; color: #d84315; }
        .category-9 { background: #e8eaf6; color: #303f9f; }
        .category-10 { background: #e0f7fa; color: #0097a7; }
        
        .link {
            color: #2575fc;
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .link:hover {
            color: #6a11cb;
            text-decoration: underline;
        }
        
        .link-icon {
            font-size: 0.9rem;
        }
        
        .folder-link {
            color: #28a745;
        }
        
        .folder-link:hover {
            color: #218838;
        }
        
        .note {
            color: #666;
            font-size: 0.9rem;
        }
        
        .empty-row {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .action-cell {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .edit-btn {
            color: #17a2b8;
        }
        
        .edit-btn:hover:not(:disabled) {
            background: #e6f7fa;
        }
        
        .delete-btn {
            color: #dc3545;
        }
        
        .delete-btn:hover:not(:disabled) {
            background: #fbe7e9;
        }
        
        .path-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: 500;
        }
        
        .badge-url {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-folder {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }
        
        .path-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .path-type-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .path-type-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
        }
        
        .path-example {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .modal-footer {
            padding: 15px 25px;
            background: #f8f9fa;
            border-top: 1px solid #eaeaea;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .stats {
            padding: 15px 30px;
            background: #f8f9fa;
            border-top: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .permission-hint {
            padding: 10px 15px;
            background: #fff3cd;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading-indicator {
            padding: 10px 15px;
            background: #d1ecf1;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #0c5460;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .error-message {
            padding: 10px 15px;
            background: #f8d7da;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #721c24;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .path-display {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
            word-break: break-all;
        }
        
        .header-edit-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid #6a11cb;
            background: white;
            padding: 0 15px;
            font-size: 0.95rem;
            font-weight: 600;
            outline: none;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            th, td {
                padding: 12px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .auth-section {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨</h1>
            <div class="admin-indicator" id="adminIndicator" style="display: none;">
                <i class="fas fa-user-shield"></i> ç®¡ç†å‘˜æ¨¡å¼
            </div>
        </header>
        
        <div class="auth-section">
            <div id="loginSection" style="display: block;">
                <div class="login-form">
                    <input type="text" id="username" class="login-input" placeholder="ç”¨æˆ·å">
                    <input type="password" id="password" class="login-input" placeholder="å¯†ç ">
                    <button class="login-btn" id="loginBtn">ç™»å½•</button>
                </div>
                <div class="github-auth" style="margin-top: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                        <input type="password" id="githubToken" class="login-input" placeholder="GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ" style="width: 250px;">
                        <button class="login-btn" id="setupGitHubBtn">é…ç½®GitHubåŒæ­¥</button>
                    </div>
                    <small style="color: #28a745; display: block;">
                        <i class="fas fa-check-circle"></i> æ­¤åŠŸèƒ½å®Œå…¨å…è´¹ - 
                        <a href="javascript:void(0)" onclick="showGitHubTokenHelp()" style="color: #28a745;">å¦‚ä½•è·å–å…è´¹ä»¤ç‰Œï¼Ÿ</a>
                    </small>
                </div>
            </div>
            <div id="userSection" style="display: none;">
                <div class="user-info">
                    <span>æ¬¢è¿, <strong id="userName">ç®¡ç†å‘˜</strong></span>
                    <span id="githubStatus" class="config-info" style="color: #28a745; margin-left: 10px;">
                        <i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥
                    </span>
                    <span class="config-info" id="configInfo"></span>
                    <button class="logout-btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>
        
        <!-- é…ç½®åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div class="loading-indicator" id="loadingIndicator" style="display: none;">
            <i class="fas fa-sync fa-spin"></i>
            <span>æ­£åœ¨ä»GitHubåŠ è½½é…ç½®...</span>
        </div>
        
        <div class="error-message" id="errorMessage" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText">é…ç½®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®</span>
        </div>
        
        <div class="controls">
            <div class="search-box">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" id="searchInput" placeholder="æœç´¢é¡µé¢åç§°ã€ç±»åˆ«æˆ–å¤‡æ³¨...">
            </div>
            
            <div class="filter-box">
                <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
                <!-- åˆ†ç±»æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="addBtn" disabled>
                    <i class="fas fa-plus"></i> æ·»åŠ æ–°æ¡ç›®
                </button>
                <button class="btn btn-success" id="exportBtn" disabled>
                    <i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®
                </button>
                <button class="btn btn-success" id="syncExcelBtn" disabled>
                    <i class="fas fa-sync"></i> åŒæ­¥åˆ° Excel
                </button>
                <button class="btn btn-success" id="updateHTMLBtn" disabled>
                    <i class="fas fa-download"></i> æ›´æ–°HTML
                </button>
                <button class="btn btn-danger" id="resetBtn" disabled>
                    <i class="fas fa-redo"></i> é‡ç½®æ•°æ®
                </button>
                <button class="btn btn-primary" id="refreshConfigBtn">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°é…ç½®
                </button>
                <button class="btn btn-primary" id="editHeadersBtn" disabled>
                    <i class="fas fa-edit"></i> ç¼–è¾‘è¡¨å¤´
                </button>
            </div>
        </div>
        
        <div class="permission-hint" id="permissionHint" style="display: flex;">
            <i class="fas fa-info-circle"></i>
            <span>æ‚¨å½“å‰æ˜¯è®¿å®¢æ¨¡å¼ï¼Œåªèƒ½æŸ¥çœ‹æ•°æ®ã€‚è¯·ç™»å½•ç®¡ç†å‘˜è´¦æˆ·ä»¥è¿›è¡Œæ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤æ“ä½œã€‚</span>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="8%" class="editable-header" data-field="id">
                            <span id="header-id">åºå·</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="18%" class="editable-header" data-field="category">
                            <span id="header-category">ç±»åˆ«</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="34%" class="editable-header" data-field="path">
                            <span id="header-path">é“¾æ¥åœ°å€</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="25%" class="editable-header" data-field="note">
                            <span id="header-note">å¤‡æ³¨</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="15%">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="stats">
            <div id="totalCount">æ€»è®¡: 0 ä¸ªé¡¹ç›®</div>
            <div id="filteredCount">æ˜¾ç¤º: 0 ä¸ªé¡¹ç›®</div>
            <div id="configVersion">é…ç½®ç‰ˆæœ¬: åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ·»åŠ æ–°æ¡ç›®</h3>
                <button class="close-btn" id="closeModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <input type="hidden" id="editId" value="">
                    <div class="form-group">
                        <label class="form-label" for="itemTitle">é¡µé¢æ ‡é¢˜</label>
                        <input type="text" class="form-control" id="itemTitle" placeholder="è¾“å…¥é¡µé¢æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemCategory">ç±»åˆ«</label>
                        <select class="form-select" id="itemCategory" required>
                            <option value="">é€‰æ‹©ç±»åˆ«</option>
                            <!-- ç±»åˆ«é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è·¯å¾„ç±»å‹</label>
                        <div class="path-type-selector">
                            <button type="button" class="path-type-btn active" data-type="url">ç½‘é¡µURL</button>
                            <button type="button" class="path-type-btn" data-type="folder">æ–‡ä»¶å¤¹è·¯å¾„</button>
                        </div>
                        <input type="text" class="form-control" id="itemPath" placeholder="è¾“å…¥ç½‘é¡µURLåœ°å€" required>
                        <div class="path-example" id="pathExample">ä¾‹å¦‚: https://example.com/page</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemNote">å¤‡æ³¨</label>
                        <textarea class="form-control" id="itemNote" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn cancel-btn" id="cancelBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveItemBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="headersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç¼–è¾‘è¡¨å¤´åç§°</h3>
                <button class="close-btn" id="closeHeadersModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="headersForm">
                    <div class="form-group">
                        <label class="form-label" for="headerIdInput">åºå·åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerIdInput" placeholder="è¾“å…¥åºå·åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerCategoryInput">ç±»åˆ«åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerCategoryInput" placeholder="è¾“å…¥ç±»åˆ«åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerPathInput">é“¾æ¥åœ°å€åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerPathInput" placeholder="è¾“å…¥é“¾æ¥åœ°å€åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerNoteInput">å¤‡æ³¨åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerNoteInput" placeholder="è¾“å…¥å¤‡æ³¨åˆ—åç§°">
                    </div>
                </form>
                <div class="permission-hint">
                    <i class="fas fa-info-circle"></i>
                    <span>ä¿®æ”¹è¡¨å¤´åç§°åï¼Œé¡µé¢æ˜¾ç¤ºä¼šç«‹å³æ›´æ–°ï¼ŒåŒæ—¶ä¼šä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä¸­ã€‚</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn cancel-btn" id="cancelHeadersBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveHeadersBtn">ä¿å­˜è¡¨å¤´</button>
                <button class="btn btn-success" id="resetHeadersBtn">é‡ç½®è¡¨å¤´</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥SheetJSåº“ç”¨äºå¤„ç†Excelæ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ç¤ºä¾‹æ•°æ® - å°†ä»GitHubé…ç½®åŠ è½½
        let tableData = [];
        
        // GitHubé…ç½®URL
        const GITHUB_OWNER = 'Cybereign';
        const GITHUB_REPO = 'securityconfig';
        const GITHUB_BRANCH = 'main';
        const GITHUB_CONFIG_URL = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/config.json`;
        const GITHUB_EXCEL_URL = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/table.xlsx`;
        
        // GitHub API ç«¯ç‚¹
        const GITHUB_API_BASE = 'https://api.github.com';
        const GITHUB_CONTENT_URL = `${GITHUB_API_BASE}/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents`;
        
        // ç”¨æˆ·è´¦æˆ·ä¿¡æ¯å’Œé…ç½®
        let adminAccounts = [];
        let appConfig = {};
        let categoryMap = {};
        let categoryList = [];

        // è¡¨å¤´é…ç½®
        let headerConfig = {
            id: 'åºå·',
            category: 'ç±»åˆ«',
            path: 'é“¾æ¥åœ°å€',
            note: 'å¤‡æ³¨'
        };

        // GitHub API æœåŠ¡
        class GitHubService {
            constructor(token) {
                this.token = token;
            }

            // è·å–æ–‡ä»¶å†…å®¹
            async getFileContent(filePath) {
                try {
                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}?ref=${GITHUB_BRANCH}`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`è·å–æ–‡ä»¶å¤±è´¥: ${response.status}`);
                    }

                    const data = await response.json();
                    // GitHub API è¿”å›çš„æ˜¯ base64 ç¼–ç çš„å†…å®¹
                    const content = atob(data.content);
                    return {
                        content: content,
                        sha: data.sha // éœ€è¦è¿™ä¸ª SHA æ¥æ›´æ–°æ–‡ä»¶
                    };
                } catch (error) {
                    console.error('è·å–æ–‡ä»¶å†…å®¹å¤±è´¥:', error);
                    throw error;
                }
            }

            // æ›´æ–°æ–‡ä»¶å†…å®¹
            async updateFileContent(filePath, content, sha, commitMessage) {
                try {
                    // å†…å®¹éœ€è¦ base64 ç¼–ç 
                    const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                    
                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: commitMessage,
                            content: contentBase64,
                            sha: sha,
                            branch: GITHUB_BRANCH
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`æ›´æ–°æ–‡ä»¶å¤±è´¥: ${response.status} - ${errorData.message}`);
                    }

                    const data = await response.json();
                    console.log('æ–‡ä»¶æ›´æ–°æˆåŠŸ:', data);
                    return data;
                } catch (error) {
                    console.error('æ›´æ–°æ–‡ä»¶å¤±è´¥:', error);
                    throw error;
                }
            }

            // æ£€æŸ¥è®¤è¯çŠ¶æ€
            async checkAuth() {
                try {
                    const response = await fetch(`${GITHUB_API_BASE}/user`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error('GitHub è®¤è¯å¤±è´¥');
                    }

                    const userData = await response.json();
                    return {
                        authenticated: true,
                        username: userData.login
                    };
                } catch (error) {
                    return {
                        authenticated: false,
                        error: error.message
                    };
                }
            }
        }

        // åˆ›å»º GitHub æœåŠ¡å®ä¾‹
        let gitHubService = null;

        // è‡ªåŠ¨ç™»å‡ºå’Œç™»å½•å°è¯•
        let logoutTimer;
        let loginAttempts = 0;

        // SHA-256å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const msgString = String(message);
            const encoder = new TextEncoder();
            const data = encoder.encode(msgString);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // ä»GitHubåŠ è½½é…ç½®å’ŒExcelè¡¨æ ¼æ•°æ®
        async function loadConfigFromGitHub() {
            showLoadingIndicator('æ­£åœ¨ä»GitHubåŠ è½½é…ç½®...');
            
            try {
                // åŠ è½½ç”¨æˆ·é…ç½®
                const configResponse = await fetch(GITHUB_CONFIG_URL);
                if (!configResponse.ok) {
                    throw new Error(`é…ç½®åŠ è½½å¤±è´¥: HTTP ${configResponse.status}`);
                }
                const config = await configResponse.json();
                
                // åŠ è½½Excelè¡¨æ ¼æ•°æ®
                const excelResponse = await fetch(GITHUB_EXCEL_URL);
                if (!excelResponse.ok) {
                    throw new Error(`Excelè¡¨æ ¼åŠ è½½å¤±è´¥: HTTP ${excelResponse.status}`);
                }
                
                const arrayBuffer = await excelResponse.arrayBuffer();
                await processExcelData(arrayBuffer);
                
                // å¤„ç†é…ç½®
                adminAccounts = config.users || [];
                appConfig = config.settings || {};
                
                console.log('âœ… GitHubé…ç½®å’ŒExcelè¡¨æ ¼æ•°æ®åŠ è½½æˆåŠŸ');
                hideLoadingIndicator();
                return true;
                
            } catch (error) {
                console.error('âŒ é…ç½®åŠ è½½å¤±è´¥:', error);
                showErrorMessage(`é…ç½®åŠ è½½å¤±è´¥: ${error.message}ï¼Œä½¿ç”¨é»˜è®¤é…ç½®`);
                useDefaultConfig();
                hideLoadingIndicator();
                return false;
            }
        }

        // ä¿®å¤è¡¨å¤´æ˜ å°„ - ç¡®ä¿ç½‘é¡µæ˜¾ç¤ºä¸Excelè¡¨å¤´ä¸€è‡´
        function getCellValue(row, headers, fieldName) {
            // é¦–å…ˆå°è¯•ç²¾ç¡®åŒ¹é…
            const index = headers.findIndex(header => {
                if (!header) return false;
                const headerStr = header.toString().trim();
                
                // å»ºç«‹æ˜ å°„å…³ç³»
                const mapping = {
                    'åºå·': ['åºå·', 'ID', 'ç¼–å·'],
                    'åˆ†ç±»': ['æ ‡é¢˜', 'åˆ†ç±»', 'ç±»åˆ«', 'Category'], 
                    'é“¾æ¥åœ°å€': ['åœ°å€', 'è·¯å¾„', 'é“¾æ¥', 'Path', 'URL'],
                    'å¤‡æ³¨': ['å¤‡æ³¨', 'è¯´æ˜', 'æè¿°', 'Note']
                };
                
                // æ£€æŸ¥å½“å‰è¡¨å¤´æ˜¯å¦åŒ¹é…ç›®æ ‡å­—æ®µ
                const targetFields = mapping[fieldName];
                if (targetFields) {
                    return targetFields.some(target => headerStr === target);
                }
                
                return headerStr === fieldName;
            });
            
            if (index !== -1 && row[index] !== undefined) {
                return row[index] !== null ? row[index].toString().trim() : '';
            }
            
            return '';
        }

        // ä¿®æ”¹ processExcelData å‡½æ•°
async function processExcelData(arrayBuffer) {
    try {
        // è¯»å–Excelæ–‡ä»¶
        const data = new Uint8Array(arrayBuffer);
        const workbook = XLSX.read(data, { type: 'array' });
        
        // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSONï¼ˆåŒ…å«è¡¨å¤´ï¼‰
        const excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
        
        if (excelData.length < 2) {
            throw new Error('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
        }
        
        // è·å–è¡¨å¤´ï¼ˆç¬¬ä¸€è¡Œï¼‰
        const headers = excelData[0];
        console.log('Excelè¡¨å¤´:', headers);
        
        // å¤„ç†æ•°æ®è¡Œï¼ˆä»ç¬¬äºŒè¡Œå¼€å§‹ï¼‰
        tableData = [];
        categoryMap = {};
        categoryList = [];
        
        for (let i = 1; i < excelData.length; i++) {
            const row = excelData[i];
            if (row.length === 0) continue;
            
            // æ ¹æ®è¡¨å¤´ä½ç½®è·å–æ•°æ®
            const item = {
                id: row[0] || i,  // ç¬¬ä¸€åˆ—ï¼šåºå·
                title: row[1] || '',  // ç¬¬äºŒåˆ—ï¼šæ ‡é¢˜
                path: row[2] || '',   // ç¬¬ä¸‰åˆ—ï¼šåœ°å€
                type: (row[3] || 'url').toLowerCase(),  // ç¬¬å››åˆ—ï¼šåœ°å€ç±»å‹
                note: row[4] || ''    // ç¬¬äº”åˆ—ï¼šå¤‡æ³¨
            };
            
            // è®¾ç½®ç±»åˆ«
            const categoryId = `category${item.id}`;
            item.category = categoryId;
            
            tableData.push(item);
            
            // æ„å»ºåˆ†ç±»æ˜ å°„
            const categoryName = item.title || `åˆ†ç±»${item.id}`;
            categoryMap[categoryId] = categoryName;
            
            if (!categoryList.find(cat => cat.id === categoryId)) {
                categoryList.push({
                    id: categoryId,
                    name: categoryName
                });
            }
        }
        
        // æ›´æ–°UI
        updateCategoryFilters();
        renderTable(tableData);
        updateStats();
        
    } catch (error) {
        console.error('Excelæ•°æ®å¤„ç†å¤±è´¥:', error);
        throw new Error(`Excelæ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`);
    }
}

        // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨
        function updateCategoryFilters() {
            const filterBox = document.querySelector('.filter-box');
            
            // æ¸…ç©ºç°æœ‰çš„åˆ†ç±»æŒ‰é’®ï¼ˆä¿ç•™"å…¨éƒ¨"æŒ‰é’®ï¼‰
            const allButton = filterBox.querySelector('[data-category="all"]');
            filterBox.innerHTML = '';
            filterBox.appendChild(allButton);
            
            // æ·»åŠ åˆ†ç±»æŒ‰é’®
            categoryList.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.setAttribute('data-category', category.id);
                button.textContent = category.name;
                filterBox.appendChild(button);
            });
            
            // é‡æ–°ç»‘å®šäº‹ä»¶
            setupFilterEvents();
        }

        // æ›´æ–°ç±»åˆ«é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateCategorySelect() {
            const categorySelect = document.getElementById('itemCategory');
            categorySelect.innerHTML = '<option value="">é€‰æ‹©ç±»åˆ«</option>';
            
            categoryList.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // ä½¿ç”¨é»˜è®¤é…ç½®
        function useDefaultConfig() {
            adminAccounts = [
                { 
                    username: 'admin', 
                    passwordHash: 'b107fce20b89ab22f4eb72843df4acc2628c88d38c54f56bdf3767f53238274f',
                    name: 'ç®¡ç†å‘˜',
                    permissions: ['read', 'write', 'delete', 'export', 'config']
                }
            ];
            
            appConfig = {
                autoLogout: 60,
                maxLoginAttempts: 5
            };
            
            // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
            tableData = [
                {
                    "id": 1,
                    "title": "DH3é¡¹ç›®åä¸ºæ¥å£è”ç³»äººæ¸…å•",
                    "category": "category1",
                    "path": "https://acndoaymjsa1.feishu.cn/file/NI95bmHjpoopKBxVGhrc7S9SnUc",
                    "type": "url",
                    "note": "é£ä¹¦ åŒ…å«åä¸ºåº§èˆ±ã€æ™ºé©¾ã€ç½‘è”ç›¸å…³æ¥å£äººä¿¡æ¯"
                },
                {
                    "id": 2,
                    "title": "DH3é¡¹ç›®è´£ä»»åˆ†å·¥",
                    "category": "category2", 
                    "path": "\\\\10.4.9.25\\Project\\DHç³»åˆ—",
                    "type": "folder",
                    "note": "å¤–ç½‘å…±äº«æ–‡ä»¶å¤¹"
                }
            ];
            
            categoryMap = {
                "category1": "DH3é¡¹ç›®åä¸ºæ¥å£è”ç³»äººæ¸…å•",
                "category2": "DH3é¡¹ç›®è´£ä»»åˆ†å·¥"
            };
            
            categoryList = [
                { id: "category1", name: "DH3é¡¹ç›®åä¸ºæ¥å£è”ç³»äººæ¸…å•" },
                { id: "category2", name: "DH3é¡¹ç›®è´£ä»»åˆ†å·¥" }
            ];
            
            updateCategoryFilters();
            updateCategorySelect();
            renderTable(tableData);
            updateStats();
            updateConfigInfo({
                project: 'DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨',
                version: 'é»˜è®¤é…ç½®',
                lastUpdated: new Date().toISOString()
            });
        }

        // æ›´æ–°é…ç½®ä¿¡æ¯æ˜¾ç¤º
        function updateConfigInfo(config) {
            const configInfo = document.getElementById('configInfo');
            const configVersion = document.getElementById('configVersion');
            
            if (configInfo && configVersion) {
                const versionInfo = config.version ? `v${config.version}` : 'æœªçŸ¥ç‰ˆæœ¬';
                const updateTime = config.lastUpdated ? new Date(config.lastUpdated).toLocaleString() : 'æœªçŸ¥æ—¶é—´';
                
                configInfo.textContent = `${config.project || 'DH3é¡¹ç›®'} ${versionInfo}`;
                configVersion.textContent = `é…ç½®ç‰ˆæœ¬: ${versionInfo} | æ›´æ–°: ${updateTime}`;
            }
        }

        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoadingIndicator(message) {
            const indicator = document.getElementById('loadingIndicator');
            const text = indicator.querySelector('span');
            if (indicator) {
                text.textContent = message;
                indicator.style.display = 'flex';
            }
        }

        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            if (errorDiv && errorText) {
                errorText.textContent = message;
                errorDiv.style.display = 'flex';
            }
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideErrorMessage() {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }

        // æ˜¾ç¤º GitHub ä»¤ç‰Œå¸®åŠ©
        function showGitHubTokenHelp() {
            alert(`GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ - å®Œå…¨å…è´¹\n\n` +
                  `å¦‚ä½•è·å–ï¼š\n` +
                  `1. ç™»å½• GitHub â†’ Settings â†’ Developer settings\n` +
                  `2. é€‰æ‹© Personal access tokens â†’ Tokens (classic)\n` +
                  `3. ç‚¹å‡» Generate new token\n` +
                  `4. è®¾ç½®å¤‡æ³¨ï¼Œé€‰æ‹©è¿‡æœŸæ—¶é—´ï¼ˆå»ºè®®1å¹´ï¼‰\n` +
                  `5. å‹¾é€‰ repo æƒé™ï¼ˆå®Œæ•´æ§åˆ¶ç§æœ‰ä»“åº“ï¼‰\n` +
                  `6. ç”Ÿæˆä»¤ç‰Œå¹¶å¤åˆ¶ä¿å­˜\n\n` +
                  `ğŸ’¡ é‡è¦æç¤ºï¼š\n` +
                  `â€¢ è¿™ä¸ªåŠŸèƒ½å®Œå…¨å…è´¹\n` +
                  `â€¢ ä¸ä¼šäº§ç”Ÿä»»ä½•è´¹ç”¨\n` +
                  `â€¢ ä»¤ç‰Œåªä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°\n` +
                  `â€¢ å¯ä»¥éšæ—¶åœ¨ GitHub ä¸Šæ’¤é”€ä»¤ç‰Œ`);
        }

        // ArrayBuffer è½¬ Base64
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        // å®Œæ•´çš„ Excel åŒæ­¥åŠŸèƒ½
        async function syncDataToExcel() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }

            if (!gitHubService) {
                alert('è¯·å…ˆé…ç½® GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ');
                document.getElementById('githubToken').focus();
                return;
            }

            try {
                showLoadingIndicator('æ­£åœ¨åŒæ­¥æ•°æ®åˆ° GitHub Excel æ–‡ä»¶...');

                // 1. è·å–å½“å‰ Excel æ–‡ä»¶çš„ SHA
                const fileInfo = await gitHubService.getFileContent('table.xlsx');
                
                // 2. è¯»å–å½“å‰ Excel æ–‡ä»¶ç»“æ„
                const arrayBuffer = await fetch(GITHUB_EXCEL_URL).then(r => r.arrayBuffer());
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // 3. è·å–åŸå§‹è¡¨å¤´ç»“æ„
                const excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                const originalHeaders = excelData[0];
                
                console.log('åŸå§‹è¡¨å¤´ç»“æ„:', originalHeaders);

                // 4. å‡†å¤‡æ–°çš„æ•°æ®
                const newData = [originalHeaders]; // ä¿æŒåŸå§‹è¡¨å¤´
                
                tableData.forEach(item => {
                    const row = new Array(originalHeaders.length).fill('');
                    
                    // æ ¹æ®åŸå§‹è¡¨å¤´ç»“æ„æ˜ å°„æ•°æ®
                    originalHeaders.forEach((header, index) => {
                        switch(header) {
                            case 'åºå·':
                                row[index] = item.id;
                                break;
                            case 'æ ‡é¢˜':
                                row[index] = item.title;
                                break;
                            case 'åœ°å€':
                                row[index] = item.path;
                                break;
                            case 'åœ°å€ç±»å‹':
                                row[index] = item.type;
                                break;
                            case 'å¤‡æ³¨':
                                row[index] = item.note;
                                break;
                            default:
                                // ä¿æŒå…¶ä»–åˆ—ä¸å˜
                                if (excelData[1] && excelData[1][index] !== undefined) {
                                    row[index] = excelData[1][index];
                                }
                        }
                    });
                    
                    newData.push(row);
                });

                // 5. åˆ›å»ºæ–°çš„å·¥ä½œè¡¨
                const newWorksheet = XLSX.utils.aoa_to_sheet(newData);
                
                // 6. åˆ›å»ºæ–°çš„å·¥ä½œç°¿
                const newWorkbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, firstSheetName);
                
                // 7. ç”Ÿæˆ Excel æ–‡ä»¶
                const excelBuffer = XLSX.write(newWorkbook, { 
                    bookType: 'xlsx', 
                    type: 'array' 
                });

                // 8. è½¬æ¢ä¸º base64
                const excelBase64 = arrayBufferToBase64(excelBuffer);

                // 9. ä¸Šä¼ åˆ° GitHub
                await gitHubService.updateFileContent(
                    'table.xlsx',
                    excelBase64,
                    fileInfo.sha,
                    `è‡ªåŠ¨åŒæ­¥è¡¨æ ¼æ•°æ® - ${new Date().toLocaleString()}`
                );

                hideLoadingIndicator();
                alert('âœ… æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ° GitHub Excel æ–‡ä»¶ï¼\né¡µé¢å°†åœ¨3ç§’ååˆ·æ–°...');
                
                // åˆ·æ–°é¡µé¢ä»¥åŠ è½½æœ€æ–°æ•°æ®
                setTimeout(() => {
                    location.reload();
                }, 3000);

            } catch (error) {
                console.error('åŒæ­¥åˆ° Excel å¤±è´¥:', error);
                hideLoadingIndicator();
                alert(`åŒæ­¥å¤±è´¥: ${error.message}`);
            }
        }

        // é…ç½® GitHub åŒæ­¥
        async function setupGitHubSync() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                alert('è¯·è¾“å…¥ GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ');
                return;
            }

            try {
                showLoadingIndicator('æ­£åœ¨éªŒè¯ GitHub ä»¤ç‰Œ...');
                
                // åˆ›å»º GitHub æœåŠ¡å®ä¾‹
                gitHubService = new GitHubService(token);
                
                // éªŒè¯ä»¤ç‰Œ
                const authResult = await gitHubService.checkAuth();
                
                if (authResult.authenticated) {
                    // ä¿å­˜ä»¤ç‰Œåˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
                    localStorage.setItem('githubToken', token);
                    document.getElementById('githubToken').value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                    
                    // æ›´æ–° UI
                    document.getElementById('githubStatus').innerHTML = 
                        `<i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥ (${authResult.username})`;
                    
                    hideLoadingIndicator();
                    alert('GitHub ä»¤ç‰Œé…ç½®æˆåŠŸï¼ç°åœ¨å¯ä»¥åŒæ­¥æ•°æ®åˆ° Excel æ–‡ä»¶äº†ã€‚');
                } else {
                    throw new Error('GitHub ä»¤ç‰ŒéªŒè¯å¤±è´¥');
                }
                
            } catch (error) {
                console.error('GitHub é…ç½®å¤±è´¥:', error);
                hideLoadingIndicator();
                alert(`GitHub é…ç½®å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥ï¼š\n1. ä»¤ç‰Œæ˜¯å¦æ­£ç¡®\n2. ä»¤ç‰Œæ˜¯å¦å…·æœ‰ repo æƒé™\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸`);
            }
        }

        // åŠ è½½ä¿å­˜çš„ GitHub ä»¤ç‰Œ
        function loadGitHubToken() {
            const savedToken = localStorage.getItem('githubToken');
            if (savedToken) {
                gitHubService = new GitHubService(savedToken);
                
                // éªŒè¯ä»¤ç‰Œæ˜¯å¦ä»ç„¶æœ‰æ•ˆ
                gitHubService.checkAuth().then(authResult => {
                    if (authResult.authenticated) {
                        document.getElementById('githubStatus').innerHTML = 
                            `<i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥ (${authResult.username})`;
                    } else {
                        // ä»¤ç‰Œå¤±æ•ˆï¼Œæ¸…é™¤ä¿å­˜çš„ä»¤ç‰Œ
                        localStorage.removeItem('githubToken');
                        gitHubService = null;
                    }
                });
            }
        }

        // DOMå…ƒç´ 
        const tableBody = document.getElementById('tableBody');
        const searchInput = document.getElementById('searchInput');
        const addBtn = document.getElementById('addBtn');
        const exportBtn = document.getElementById('exportBtn');
        const syncExcelBtn = document.getElementById('syncExcelBtn');
        const updateHTMLBtn = document.getElementById('updateHTMLBtn');
        const resetBtn = document.getElementById('resetBtn');
        const refreshConfigBtn = document.getElementById('refreshConfigBtn');
        const editHeadersBtn = document.getElementById('editHeadersBtn');
        const itemModal = document.getElementById('itemModal');
        const headersModal = document.getElementById('headersModal');
        const modalTitle = document.getElementById('modalTitle');
        const itemForm = document.getElementById('itemForm');
        const headersForm = document.getElementById('headersForm');
        const editId = document.getElementById('editId');
        const itemTitle = document.getElementById('itemTitle');
        const itemCategory = document.getElementById('itemCategory');
        const itemPath = document.getElementById('itemPath');
        const itemNote = document.getElementById('itemNote');
        const saveItemBtn = document.getElementById('saveItemBtn');
        const closeModal = document.getElementById('closeModal');
        const closeHeadersModal = document.getElementById('closeHeadersModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const cancelHeadersBtn = document.getElementById('cancelHeadersBtn');
        const saveHeadersBtn = document.getElementById('saveHeadersBtn');
        const resetHeadersBtn = document.getElementById('resetHeadersBtn');
        const totalCount = document.getElementById('totalCount');
        const filteredCount = document.getElementById('filteredCount');
        const pathTypeButtons = document.querySelectorAll('.path-type-btn');
        const pathExample = document.getElementById('pathExample');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginSection = document.getElementById('loginSection');
        const userSection = document.getElementById('userSection');
        const userName = document.getElementById('userName');
        const adminIndicator = document.getElementById('adminIndicator');
        const permissionHint = document.getElementById('permissionHint');
        const setupGitHubBtn = document.getElementById('setupGitHubBtn');

        // å½“å‰æ˜¾ç¤ºçš„æ•°æ®å’Œè·¯å¾„ç±»å‹
        let currentData = [...tableData];
        let currentPathType = 'url';
        let isLoggedIn = false;
        let currentUser = null;

        // æ•°æ®æŒä¹…åŒ–å‡½æ•°
        function saveDataToStorage() {
            localStorage.setItem('h5IndexData', JSON.stringify(tableData));
        }

        function loadDataFromStorage() {
            const savedData = localStorage.getItem('h5IndexData');
            if (savedData) {
                return JSON.parse(savedData);
            }
            return null;
        }

        // è¡¨å¤´é…ç½®æŒä¹…åŒ–
        function saveHeadersToStorage() {
            localStorage.setItem('h5IndexHeaders', JSON.stringify(headerConfig));
        }

        function loadHeadersFromStorage() {
            const savedHeaders = localStorage.getItem('h5IndexHeaders');
            if (savedHeaders) {
                return JSON.parse(savedHeaders);
            }
            return null;
        }

        // è®¾ç½®è‡ªåŠ¨ç™»å‡º
        function setupAutoLogout() {
            // æ¸…é™¤ç°æœ‰è®¡æ—¶å™¨
            if (logoutTimer) {
                clearTimeout(logoutTimer);
            }
            
            // è·å–è‡ªåŠ¨ç™»å‡ºæ—¶é—´è®¾ç½®ï¼ˆåˆ†é’Ÿï¼‰
            const autoLogoutMinutes = appConfig.autoLogout || 60;
            
            // è®¾ç½®æ–°çš„è®¡æ—¶å™¨
            logoutTimer = setTimeout(() => {
                if (isLoggedIn) {
                    alert(`ç”±äºé•¿æ—¶é—´æœªæ“ä½œï¼Œç³»ç»Ÿå·²è‡ªåŠ¨ç™»å‡ºã€‚è‡ªåŠ¨ç™»å‡ºæ—¶é—´ï¼š${autoLogoutMinutes}åˆ†é’Ÿ`);
                    handleLogout();
                }
            }, autoLogoutMinutes * 60 * 1000); // è½¬æ¢ä¸ºæ¯«ç§’
        }

        // é‡ç½®è‡ªåŠ¨ç™»å‡ºè®¡æ—¶å™¨ï¼ˆåœ¨ç”¨æˆ·æ“ä½œæ—¶è°ƒç”¨ï¼‰
        function resetAutoLogoutTimer() {
            if (isLoggedIn) {
                setupAutoLogout();
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            // åŠ è½½è¡¨å¤´é…ç½®
            const savedHeaders = loadHeadersFromStorage();
            if (savedHeaders) {
                headerConfig = savedHeaders;
            }
            updateTableHeaders();

            // åŠ è½½ä¿å­˜çš„ GitHub ä»¤ç‰Œ
            loadGitHubToken();

            // ä»GitHubåŠ è½½é…ç½®
            await loadConfigFromGitHub();
            
            // åŠ è½½æœ¬åœ°æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
            const savedData = loadDataFromStorage();
            if (savedData && savedData.length > 0) {
                tableData = savedData;
                currentData = [...tableData];
                renderTable(currentData);
                updateStats();
            }
            
            setupEventListeners();
            checkLoginStatus();
            updateCategorySelect();
            
            // è®¾ç½®ç”¨æˆ·æ´»åŠ¨ç›‘å¬å™¨
            document.addEventListener('click', resetAutoLogoutTimer);
            document.addEventListener('keypress', resetAutoLogoutTimer);
            document.addEventListener('mousemove', resetAutoLogoutTimer);
        });

        // æ›´æ–°è¡¨æ ¼è¡¨å¤´æ˜¾ç¤º
        function updateTableHeaders() {
            document.getElementById('header-id').textContent = headerConfig.id;
            document.getElementById('header-category').textContent = headerConfig.category;
            document.getElementById('header-path').textContent = headerConfig.path;
            document.getElementById('header-note').textContent = headerConfig.note;

            // æ›´æ–°æœç´¢æ¡†å ä½ç¬¦
            searchInput.placeholder = `æœç´¢é¡µé¢åç§°ã€${headerConfig.category.toLowerCase()}æˆ–${headerConfig.note.toLowerCase()}...`;
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('h5IndexCurrentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                loginSuccess(user);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æœç´¢åŠŸèƒ½
            searchInput.addEventListener('input', handleSearch);
            
            // è·¯å¾„ç±»å‹é€‰æ‹©
            pathTypeButtons.forEach(btn => {
                btn.addEventListener('click', handlePathTypeChange);
            });
            
            // æ·»åŠ æ–°æ¡ç›®
            addBtn.addEventListener('click', () => openModal());
            
            // å¯¼å‡ºæ•°æ®
            exportBtn.addEventListener('click', exportData);
            
            // åŒæ­¥åˆ° Excel
            syncExcelBtn.addEventListener('click', syncDataToExcel);
            
            // æ›´æ–°HTML
            updateHTMLBtn.addEventListener('click', downloadUpdatedHTML);
            
            // é‡ç½®æ•°æ®
            resetBtn.addEventListener('click', resetData);
            
            // åˆ·æ–°é…ç½®
            refreshConfigBtn.addEventListener('click', refreshConfig);
            
            // ç¼–è¾‘è¡¨å¤´
            editHeadersBtn.addEventListener('click', openHeadersModal);
            
            // GitHub é…ç½®
            setupGitHubBtn.addEventListener('click', setupGitHubSync);
            
            // æ¨¡æ€æ¡†æ§åˆ¶
            closeModal.addEventListener('click', closeModalFunc);
            closeHeadersModal.addEventListener('click', closeHeadersModalFunc);
            cancelBtn.addEventListener('click', closeModalFunc);
            cancelHeadersBtn.addEventListener('click', closeHeadersModalFunc);
            saveItemBtn.addEventListener('click', saveItem);
            saveHeadersBtn.addEventListener('click', saveHeaders);
            resetHeadersBtn.addEventListener('click', resetHeaders);
            
            // ç™»å½•/ç™»å‡º
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', (e) => {
                if (e.target === itemModal) {
                    closeModalFunc();
                }
                if (e.target === headersModal) {
                    closeHeadersModalFunc();
                }
            });
            
            // å›è½¦ç™»å½•
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });

            // è¡¨å¤´ç‚¹å‡»ç¼–è¾‘
            setupHeaderEditListeners();
        }

        // è®¾ç½®è¡¨å¤´ç¼–è¾‘äº‹ä»¶
        function setupHeaderEditListeners() {
            const editableHeaders = document.querySelectorAll('.editable-header');
            editableHeaders.forEach(header => {
                header.addEventListener('click', (e) => {
                    if (isLoggedIn && currentUser && currentUser.permissions.includes('config')) {
                        editHeader(e.currentTarget);
                    }
                });
            });
        }

        // ç¼–è¾‘å•ä¸ªè¡¨å¤´
        function editHeader(headerElement) {
            const field = headerElement.dataset.field;
            const currentText = headerElement.querySelector('span').textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'header-edit-input';
            input.value = currentText;
            
            headerElement.style.position = 'relative';
            headerElement.appendChild(input);
            input.focus();
            input.select();
            
            const saveEdit = () => {
                const newValue = input.value.trim();
                if (newValue && newValue !== currentText) {
                    headerConfig[field] = newValue;
                    saveHeadersToStorage();
                    updateTableHeaders();
                }
                headerElement.removeChild(input);
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                }
                if (e.key === 'Escape') {
                    headerElement.removeChild(input);
                }
            });
        }

        // è®¾ç½®ç­›é€‰äº‹ä»¶
        function setupFilterEvents() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', handleFilter);
            });
        }

        // æ‰“å¼€è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡†
        function openHeadersModal() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            document.getElementById('headerIdInput').value = headerConfig.id;
            document.getElementById('headerCategoryInput').value = headerConfig.category;
            document.getElementById('headerPathInput').value = headerConfig.path;
            document.getElementById('headerNoteInput').value = headerConfig.note;
            
            headersModal.style.display = 'flex';
        }

        // å…³é—­è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡†
        function closeHeadersModalFunc() {
            headersModal.style.display = 'none';
        }

        // ä¿å­˜è¡¨å¤´é…ç½®
        function saveHeaders() {
            const newHeaders = {
                id: document.getElementById('headerIdInput').value.trim() || 'åºå·',
                category: document.getElementById('headerCategoryInput').value.trim() || 'ç±»åˆ«',
                path: document.getElementById('headerPathInput').value.trim() || 'é“¾æ¥åœ°å€',
                note: document.getElementById('headerNoteInput').value.trim() || 'å¤‡æ³¨'
            };
            
            headerConfig = newHeaders;
            saveHeadersToStorage();
            updateTableHeaders();
            closeHeadersModalFunc();
            alert('è¡¨å¤´åç§°å·²æ›´æ–°ï¼');
        }

        // é‡ç½®è¡¨å¤´é…ç½®
        function resetHeaders() {
            headerConfig = {
                id: 'åºå·',
                category: 'ç±»åˆ«',
                path: 'é“¾æ¥åœ°å€',
                note: 'å¤‡æ³¨'
            };
            saveHeadersToStorage();
            updateTableHeaders();
            closeHeadersModalFunc();
            alert('è¡¨å¤´åç§°å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼');
        }

        // åˆ·æ–°é…ç½®
        async function refreshConfig() {
            const success = await loadConfigFromGitHub();
            if (success) {
                alert('é…ç½®åˆ·æ–°æˆåŠŸï¼');
                // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œé‡æ–°æ£€æŸ¥æƒé™
                if (isLoggedIn && currentUser) {
                    const updatedUser = adminAccounts.find(acc => acc.username === currentUser.username);
                    if (updatedUser) {
                        currentUser.permissions = updatedUser.permissions;
                        updateUIForPermissions();
                    }
                }
            }
        }

        // æ ¹æ®æƒé™æ›´æ–°UI
        function updateUIForPermissions() {
            if (!currentUser) return;
            
            const canWrite = currentUser.permissions.includes('write');
            const canDelete = currentUser.permissions.includes('delete');
            const canExport = currentUser.permissions.includes('export');
            const canConfig = currentUser.permissions.includes('config');
            
            // æ›´æ–°æ“ä½œæŒ‰é’®çŠ¶æ€
            addBtn.disabled = !canWrite;
            resetBtn.disabled = !canDelete;
            exportBtn.disabled = !canExport;
            syncExcelBtn.disabled = !canExport;
            updateHTMLBtn.disabled = !canExport;
            editHeadersBtn.disabled = !canConfig;
            
            // è®¾ç½®è¡¨å¤´æ˜¯å¦å¯ç¼–è¾‘
            const editableHeaders = document.querySelectorAll('.editable-header');
            editableHeaders.forEach(header => {
                if (canConfig) {
                    header.style.cursor = 'pointer';
                } else {
                    header.style.cursor = 'default';
                }
            });
        }

        // å¤„ç†ç™»å½•
        async function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            // æ£€æŸ¥ç™»å½•å°è¯•æ¬¡æ•°
            const maxAttempts = appConfig.maxLoginAttempts || 5;
            if (loginAttempts >= maxAttempts) {
                alert(`ç™»å½•å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•ã€‚æœ€å¤§å°è¯•æ¬¡æ•°ï¼š${maxAttempts}`);
                return;
            }
            
            // è®¡ç®—è¾“å…¥å¯†ç çš„å“ˆå¸Œå€¼
            const passwordHash = await sha256(password);
            
            // å®‰å…¨åœ°æŸ¥æ‰¾ç”¨æˆ·
            const user = adminAccounts.find(acc => 
                acc.username === username && acc.passwordHash === passwordHash
            );
            
            if (user) {
                // ç™»å½•æˆåŠŸï¼Œé‡ç½®å°è¯•æ¬¡æ•°
                loginAttempts = 0;
                loginSuccess(user);
                localStorage.setItem('h5IndexCurrentUser', JSON.stringify({
                    username: user.username,
                    name: user.name,
                    permissions: user.permissions || ['read']
                }));
            } else {
                // ç™»å½•å¤±è´¥ï¼Œå¢åŠ å°è¯•æ¬¡æ•°
                loginAttempts++;
                const remainingAttempts = maxAttempts - loginAttempts;
                alert(`ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°ï¼š${remainingAttempts}`);
                
                // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // ç™»å½•æˆåŠŸ
        function loginSuccess(user) {
            isLoggedIn = true;
            currentUser = user;
            
            // æ›´æ–°UI
            loginSection.style.display = 'none';
            userSection.style.display = 'block';
            userName.textContent = user.name;
            adminIndicator.style.display = 'flex';
            permissionHint.style.display = 'none';
            
            // æ ¹æ®æƒé™å¯ç”¨åŠŸèƒ½
            updateUIForPermissions();
            
            // é‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥å¯ç”¨æ“ä½œæŒ‰é’®
            renderTable(currentData);
            
            // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
            passwordInput.value = '';
            
            // è®¾ç½®è‡ªåŠ¨ç™»å‡ºè®¡æ—¶å™¨
            setupAutoLogout();
        }

        // å¤„ç†ç™»å‡º
        function handleLogout() {
            isLoggedIn = false;
            currentUser = null;
            
            // æ¸…é™¤è‡ªåŠ¨ç™»å‡ºè®¡æ—¶å™¨
            if (logoutTimer) {
                clearTimeout(logoutTimer);
                logoutTimer = null;
            }
            
            // æ›´æ–°UI
            loginSection.style.display = 'block';
            userSection.style.display = 'none';
            adminIndicator.style.display = 'none';
            permissionHint.style.display = 'flex';
            
            // ç¦ç”¨æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½
            addBtn.disabled = true;
            resetBtn.disabled = true;
            exportBtn.disabled = true;
            syncExcelBtn.disabled = true;
            updateHTMLBtn.disabled = true;
            editHeadersBtn.disabled = true;
            
            // æ¸…é™¤ä¿å­˜çš„ç™»å½•çŠ¶æ€
            localStorage.removeItem('h5IndexCurrentUser');
            
            // é‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥ç¦ç”¨æ“ä½œæŒ‰é’®
            renderTable(currentData);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            usernameInput.value = '';
            passwordInput.value = '';
        }

        // å¤„ç†è·¯å¾„ç±»å‹å˜åŒ–
        function handlePathTypeChange(e) {
            pathTypeButtons.forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            currentPathType = e.currentTarget.dataset.type;
            
            // æ›´æ–°è·¯å¾„ç¤ºä¾‹
            if (currentPathType === 'url') {
                pathExample.textContent = 'ä¾‹å¦‚: https://example.com/page';
                itemPath.placeholder = 'è¾“å…¥ç½‘é¡µURLåœ°å€';
            } else {
                pathExample.textContent = 'ä¾‹å¦‚: \\\\10.4.9.25\\Project\\æ–‡ä»¶å¤¹ æˆ– D:\\Projects\\æ–‡ä»¶å¤¹';
                itemPath.placeholder = 'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„';
            }
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="empty-row">æœªæ‰¾åˆ°åŒ¹é…çš„é¡µé¢</td></tr>`;
                return;
            }
            
            tableBody.innerHTML = data.map(item => {
                const isUrl = item.type === 'url';
                const linkClass = isUrl ? 'link' : 'link folder-link';
                const iconClass = isUrl ? 'fas fa-external-link-alt' : 'fas fa-folder-open';
                const badgeClass = isUrl ? 'badge-url' : 'badge-folder';
                const badgeText = isUrl ? 'ç½‘é¡µ' : 'æ–‡ä»¶å¤¹';
                const categoryName = categoryMap[item.category] || item.category;
                const categoryClass = `category-${(item.id % 10) || 1}`;
                
                // ä¸ºURLé“¾æ¥æ·»åŠ target="_blank"ï¼Œæ–‡ä»¶å¤¹é“¾æ¥ä½¿ç”¨è‡ªå®šä¹‰å¤„ç†
                if (isUrl) {
                    return `
                    <tr>
                        <td>${item.id}</td>
                        <td><span class="category ${categoryClass}">${categoryName}</span></td>
                        <td>
                            <a href="${item.path}" target="_blank" class="${linkClass}">
                                <i class="${iconClass} link-icon"></i> 
                                ${item.title}
                                <span class="path-type-badge ${badgeClass}">${badgeText}</span>
                            </a>
                        </td>
                        <td class="note">${item.note}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    `;
                } else {
                    return `
                    <tr>
                        <td>${item.id}</td>
                        <td><span class="category ${categoryClass}">${categoryName}</span></td>
                        <td>
                            <a href="#" class="${linkClass}" onclick="openFolder('${item.path.replace(/\\/g, '\\\\')}')">
                                <i class="${iconClass} link-icon"></i> 
                                ${item.title}
                                <span class="path-type-badge ${badgeClass}">${badgeText}</span>
                            </a>
                        </td>
                        <td class="note">${item.note}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    `;
                }
            }).join('');
            
            // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶
            document.querySelectorAll('.edit-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        openModal(id);
                    });
                }
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        deleteItem(id);
                    });
                }
            });
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats();
        }

        // æ‰“å¼€æ–‡ä»¶å¤¹è·¯å¾„
        function openFolder(path) {
            // è§£ç è·¯å¾„ï¼ˆå°†\\\\æ¢å¤ä¸º\\ï¼‰
            const decodedPath = path.replace(/\\\\/g, '\\');
            
            // å°è¯•ä½¿ç”¨fileåè®®æ‰“å¼€
            const fileUrl = `file:///${decodedPath.replace(/\\/g, '/')}`;
            
            // åˆ›å»ºæµ‹è¯•é“¾æ¥æ£€æŸ¥åè®®æ”¯æŒ
            const testLink = document.createElement('a');
            testLink.href = 'file:///';
            
            if (testLink.protocol === 'file:') {
                // å°è¯•åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€
                window.open(fileUrl, '_blank');
            } else {
                // å¦‚æœä¸æ”¯æŒfileåè®®ï¼Œæä¾›å¤åˆ¶è·¯å¾„åŠŸèƒ½
                if (confirm('ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥æ‰“å¼€æ–‡ä»¶å¤¹ã€‚æ˜¯å¦å¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿ï¼Ÿ\n\nè·¯å¾„: ' + decodedPath)) {
                    navigator.clipboard.writeText(decodedPath).then(() => {
                        alert('æ–‡ä»¶å¤¹è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè·¯å¾„: ' + decodedPath + '\n\næ‚¨å¯ä»¥åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨çš„åœ°å€æ ä¸­ç²˜è´´æ­¤è·¯å¾„æ¥æ‰“å¼€æ–‡ä»¶å¤¹ã€‚');
                    }).catch(err => {
                        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                        const textArea = document.createElement('textarea');
                        textArea.value = decodedPath;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('æ–‡ä»¶å¤¹è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè·¯å¾„: ' + decodedPath);
                    });
                }
            }
            return false;
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            totalCount.textContent = `æ€»è®¡: ${tableData.length} ä¸ªé¡¹ç›®`;
            filteredCount.textContent = `æ˜¾ç¤º: ${currentData.length} ä¸ªé¡¹ç›®`;
        }

        // å¤„ç†æœç´¢
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';
            filterTable(searchTerm, activeCategory);
        }

        // å¤„ç†ç­›é€‰
        function handleFilter(e) {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            
            const searchTerm = searchInput.value.toLowerCase();
            const category = e.currentTarget.dataset.category;
            filterTable(searchTerm, category);
        }

        // ç­›é€‰è¡¨æ ¼æ•°æ®
        function filterTable(searchTerm, category) {
            let filteredData = tableData;
            
            // æŒ‰æœç´¢è¯ç­›é€‰
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.title.toLowerCase().includes(searchTerm) || 
                    (categoryMap[item.category] || item.category).toLowerCase().includes(searchTerm) ||
                    item.note.toLowerCase().includes(searchTerm) ||
                    item.path.toLowerCase().includes(searchTerm)
                );
            }
            
            // æŒ‰ç±»åˆ«ç­›é€‰
            if (category !== 'all') {
                filteredData = filteredData.filter(item => item.category === category);
            }
            
            currentData = filteredData;
            renderTable(currentData);
        }

        // æ‰“å¼€æ¨¡æ€æ¡†ï¼ˆæ·»åŠ æˆ–ç¼–è¾‘ï¼‰
        function openModal(id = null) {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (id) {
                // ç¼–è¾‘æ¨¡å¼
                const item = tableData.find(item => item.id === id);
                if (item) {
                    modalTitle.textContent = 'ç¼–è¾‘æ¡ç›®';
                    editId.value = item.id;
                    itemTitle.value = item.title;
                    itemCategory.value = item.category;
                    itemPath.value = item.path;
                    itemNote.value = item.note;
                    
                    // è®¾ç½®è·¯å¾„ç±»å‹
                    currentPathType = item.type;
                    pathTypeButtons.forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.type === item.type);
                    });
                    updatePathExample();
                }
            } else {
                // æ·»åŠ æ¨¡å¼
                modalTitle.textContent = 'æ·»åŠ æ–°æ¡ç›®';
                itemForm.reset();
                editId.value = '';
                
                // é‡ç½®è·¯å¾„ç±»å‹ä¸ºURL
                currentPathType = 'url';
                pathTypeButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.type === 'url');
                });
                updatePathExample();
            }
            
            itemModal.style.display = 'flex';
        }

        // æ›´æ–°è·¯å¾„ç¤ºä¾‹
        function updatePathExample() {
            if (currentPathType === 'url') {
                pathExample.textContent = 'ä¾‹å¦‚: https://example.com/page';
                itemPath.placeholder = 'è¾“å…¥ç½‘é¡µURLåœ°å€';
            } else {
                pathExample.textContent = 'ä¾‹å¦‚: \\\\10.4.9.25\\Project\\æ–‡ä»¶å¤¹ æˆ– D:\\Projects\\æ–‡ä»¶å¤¹';
                itemPath.placeholder = 'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„';
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModalFunc() {
            itemModal.style.display = 'none';
            itemForm.reset();
        }

        // ä¿å­˜æ¡ç›®ï¼ˆæ·»åŠ æˆ–æ›´æ–°ï¼‰
        function saveItem() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            // è¡¨å•éªŒè¯
            if (!itemTitle.value.trim() || !itemCategory.value || !itemPath.value.trim()) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }
            
            // è‡ªåŠ¨æ£€æµ‹è·¯å¾„ç±»å‹
            const pathValue = itemPath.value.trim();
            let detectedType = currentPathType;
            
            // å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜ç¡®é€‰æ‹©ç±»å‹ï¼Œå°è¯•è‡ªåŠ¨æ£€æµ‹
            if (pathValue.startsWith('http://') || pathValue.startsWith('https://')) {
                detectedType = 'url';
            } else if (pathValue.includes('\\\\') || pathValue.includes(':\\')) {
                detectedType = 'folder';
            }
            
            const id = editId.value ? parseInt(editId.value) : generateId();
            const newItem = {
                id: id,
                title: itemTitle.value.trim(),
                category: itemCategory.value,
                path: pathValue,
                type: detectedType,
                note: itemNote.value.trim()
            };
            
            if (editId.value) {
                // æ›´æ–°ç°æœ‰æ¡ç›®
                const index = tableData.findIndex(item => item.id === id);
                if (index !== -1) {
                    tableData[index] = newItem;
                }
            } else {
                // æ·»åŠ æ–°æ¡ç›®
                tableData.push(newItem);
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveDataToStorage();
            
            // é‡æ–°åº”ç”¨å½“å‰ç­›é€‰æ¡ä»¶
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
            filterTable(searchTerm, activeCategory);
            
            closeModalFunc();
        }

        // ç”Ÿæˆæ–°ID
        function generateId() {
            return tableData.length > 0 ? Math.max(...tableData.map(item => item.id)) + 1 : 1;
        }

        // åˆ é™¤æ¡ç›®
        function deleteItem(id) {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡ç›®å—ï¼Ÿ')) {
                tableData = tableData.filter(item => item.id !== id);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveDataToStorage();
                
                // é‡æ–°åº”ç”¨å½“å‰ç­›é€‰æ¡ä»¶
                const searchTerm = searchInput.value.toLowerCase();
                const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
                filterTable(searchTerm, activeCategory);
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(tableData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'h5-index-data.json';
            link.click();
        }

        // ç”Ÿæˆå¹¶ä¸‹è½½æ›´æ–°åçš„HTMLæ–‡ä»¶
        function downloadUpdatedHTML() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            // åˆ›å»ºæ›´æ–°åçš„HTMLå†…å®¹
            const updatedHTML = generateUpdatedHTML();
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([updatedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨_æ›´æ–°ç‰ˆ.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æ›´æ–°åçš„HTMLæ–‡ä»¶å·²ç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½ï¼');
        }

        // ç”ŸæˆåŒ…å«å½“å‰æ•°æ®çš„HTML
        function generateUpdatedHTML() {
            // è·å–å½“å‰é¡µé¢çš„HTMLå†…å®¹
            const currentHTML = document.documentElement.outerHTML;
            
            // æ‰¾åˆ°tableDataçš„å®šä¹‰ä½ç½®å¹¶æ›¿æ¢ä¸ºå½“å‰æ•°æ®
            const dataRegex = /let tableData = \[[\s\S]*?\];/;
            const newDataDefinition = `let tableData = ${JSON.stringify(tableData, null, 8)};`;
            
            // æ›¿æ¢æ•°æ®å®šä¹‰
            let updatedHTML = currentHTML.replace(dataRegex, newDataDefinition);
            
            // æ‰¾åˆ°tablebodyå¹¶æ¸…ç©ºå…¶å†…å®¹ï¼Œåªä¿ç•™æ³¨é‡Š
            const tableBodyRegex = /<tbody id="tableBody">[\s\S]*?<\/tbody>/;
            const emptyTableBody = `<tbody id="tableBody">\n                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->\n                </tbody>`;
            
            updatedHTML = updatedHTML.replace(tableBodyRegex, emptyTableBody);
            
            return updatedHTML;
        }

        // é‡ç½®æ•°æ®
        function resetData() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (confirm('ç¡®å®šè¦é‡ç½®æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æœ¬åœ°ä¿®æ”¹ï¼Œæ¢å¤ä¸ºGitHubé…ç½®çš„æ•°æ®ã€‚')) {
                // é‡æ–°åŠ è½½GitHubé…ç½®
                loadConfigFromGitHub();
                localStorage.removeItem('h5IndexData');
                alert('æ•°æ®å·²é‡ç½®ä¸ºGitHubé…ç½®çš„åˆå§‹çŠ¶æ€');
            }
        }
    </script>
</body>
</html>
