<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
    
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .admin-indicator {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .auth-section {
            padding: 15px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .login-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .login-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .login-btn {
            padding: 8px 15px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .login-btn:hover {
            background: #5a0db5;
        }
        
        .logout-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-info {
            font-size: 0.8rem;
            color: #666;
            margin-left: 10px;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }
        
        .filter-box {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 18px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover {
            background: #f0f0f0;
        }
        
        .filter-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #6a11cb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a0db5;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #eaeaea;
            font-size: 0.95rem;
            position: relative;
        }
        
        .editable-header {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .editable-header:hover {
            background: #e9ecef;
        }
        
        .editable-header .edit-icon {
            opacity: 0;
            margin-left: 5px;
            font-size: 0.8rem;
            transition: opacity 0.2s;
        }
        
        .editable-header:hover .edit-icon {
            opacity: 1;
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid #eaeaea;
            font-size: 0.95rem;
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f8f9ff;
        }
        
        .category {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .category-1 { background: #e3f2fd; color: #1976d2; }
        .category-2 { background: #e8f5e9; color: #388e3c; }
        .category-3 { background: #fff3e0; color: #f57c00; }
        .category-4 { background: #fce4ec; color: #c2185b; }
        .category-5 { background: #f3e5f5; color: #7b1fa2; }
        .category-6 { background: #e0f2f1; color: #00796b; }
        .category-7 { background: #fff8e1; color: #ff8f00; }
        .category-8 { background: #fbe9e7; color: #d84315; }
        .category-9 { background: #e8eaf6; color: #303f9f; }
        .category-10 { background: #e0f7fa; color: #0097a7; }
        
        .link {
            color: #2575fc;
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .link:hover {
            color: #6a11cb;
            text-decoration: underline;
        }
        
        .link-icon {
            font-size: 0.9rem;
        }
        
        .folder-link {
            color: #28a745;
        }
        
        .folder-link:hover {
            color: #218838;
        }
        
.note {
    color: #666;
    font-size: 0.9rem;
    white-space: pre-wrap; /* å…³é”®å±æ€§ï¼šä¿ç•™æ¢è¡Œ */
    word-break: break-word; /* é˜²æ­¢é•¿æ–‡æœ¬æº¢å‡º */
    line-height: 1.4; /* æ”¹å–„å¯è¯»æ€§ */
}
        #itemNote {
    white-space: pre-wrap;
    word-break: break-word;
    line-height: 1.4;
    min-height: 80px;
    resize: vertical;
    font-family: inherit; /* ä½¿ç”¨ç›¸åŒçš„å­—ä½“ */
}
        .empty-row {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .action-cell {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .edit-btn {
            color: #17a2b8;
        }
        
        .edit-btn:hover:not(:disabled) {
            background: #e6f7fa;
        }
        
        .delete-btn {
            color: #dc3545;
        }
        
        .delete-btn:hover:not(:disabled) {
            background: #fbe7e9;
        }
        
        .path-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: 500;
        }
        
        .badge-url {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-folder {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
/* ğŸ†• æ–°å¢ï¼šå¤‡æ³¨æ–‡æœ¬åŸŸç‰¹æ®Šæ ·å¼ */
#itemNote {
    white-space: pre-wrap;
    word-break: break-word;
    line-height: 1.4;
    min-height: 80px;
    resize: vertical;
    font-family: inherit;
}
        
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }
        
        .path-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .path-type-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .path-type-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
        }
        
        .path-example {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .modal-footer {
            padding: 15px 25px;
            background: #f8f9fa;
            border-top: 1px solid #eaeaea;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .stats {
            padding: 15px 30px;
            background: #f8f9fa;
            border-top: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .permission-hint {
            padding: 10px 15px;
            background: #fff3cd;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading-indicator {
            padding: 10px 15px;
            background: #d1ecf1;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #0c5460;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .error-message {
            padding: 10px 15px;
            background: #f8d7da;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #721c24;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .path-display {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
            word-break: break-all;
        }
        
        .header-edit-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid #6a11cb;
            background: white;
            padding: 0 15px;
            font-size: 0.95rem;
            font-weight: 600;
            outline: none;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast-success {
            background: #28a745;
        }
        
        .toast-error {
            background: #dc3545;
        }
        
        .toast-info {
            background: #17a2b8;
        }
        
        .toast-warning {
            background: #ffc107;
            color: #212529;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            th, td {
                padding: 12px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .auth-section {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨</h1>
            <div class="admin-indicator" id="adminIndicator" style="display: none;">
                <i class="fas fa-user-shield"></i> ç®¡ç†å‘˜æ¨¡å¼
            </div>
        </header>
        
        <div class="auth-section">
            <div id="loginSection" style="display: block;">
                <div class="login-form">
                    <input type="text" id="username" class="login-input" placeholder="ç”¨æˆ·å">
                    <input type="password" id="password" class="login-input" placeholder="å¯†ç ">
                    <button class="login-btn" id="loginBtn">ç™»å½•</button>
                </div>
                <div class="github-auth" style="margin-top: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                        <input type="password" id="githubToken" class="login-input" placeholder="GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ" style="width: 250px;">
                        <button class="login-btn" id="setupGitHubBtn">é…ç½®GitHubåŒæ­¥</button>
                    </div>
                    <small style="color: #28a745; display: block;">
                        <i class="fas fa-check-circle"></i> æ­¤åŠŸèƒ½å®Œå…¨å…è´¹ - 
                        <a href="javascript:void(0)" onclick="showGitHubTokenHelp()" style="color: #28a745;">å¦‚ä½•è·å–å…è´¹ä»¤ç‰Œï¼Ÿ</a>
                    </small>
                </div>
            </div>
            <div id="userSection" style="display: none;">
                <div class="user-info">
                    <span>æ¬¢è¿, <strong id="userName">ç®¡ç†å‘˜</strong></span>
                    <span id="githubStatus" class="config-info" style="color: #28a745; margin-left: 10px;">
                        <i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥
                    </span>
                    <span class="config-info" id="configInfo"></span>
                    <button class="logout-btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>
        
        <!-- é…ç½®åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div class="loading-indicator" id="loadingIndicator" style="display: none;">
            <i class="fas fa-sync fa-spin"></i>
            <span>æ­£åœ¨ä»GitHubåŠ è½½é…ç½®...</span>
        </div>
        
        <div class="error-message" id="errorMessage" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText">é…ç½®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®</span>
        </div>
        
        <div class="controls">
            <div class="search-box">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" id="searchInput" placeholder="æœç´¢é¡µé¢åç§°ã€åˆ†ç±»æˆ–å¤‡æ³¨...">
            </div>
            
            <div class="filter-box">
                <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
                <!-- åˆ†ç±»æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="addBtn" style="display: none;">
                    <i class="fas fa-plus"></i> æ·»åŠ æ–°æ¡ç›®
                </button>
                <button class="btn btn-success" id="exportBtn" style="display: none;">
                    <i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®
                </button>
                <button class="btn btn-success" id="syncExcelBtn" style="display: none;">
                    <i class="fas fa-sync"></i> åŒæ­¥åˆ° Excel
                </button>
                <button class="btn btn-success" id="downloadExcelBtn">
                    <i class="fas fa-download"></i> ä¸‹è½½ Excel
                </button>
                <button class="btn btn-warning" id="repairExcelBtn" style="display: none;">
                    <i class="fas fa-tools"></i> ä¿®å¤Excelæ ¼å¼
                </button>
                <button class="btn btn-success" id="updateHTMLBtn" style="display: none;">
                    <i class="fas fa-download"></i> æ›´æ–°HTML
                </button>
                <button class="btn btn-danger" id="resetBtn" style="display: none;">
                    <i class="fas fa-redo"></i> é‡ç½®æ•°æ®
                </button>
                <button class="btn btn-primary" id="refreshConfigBtn">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°é…ç½®
                </button>
                <button class="btn btn-primary" id="editHeadersBtn" style="display: none;">
                    <i class="fas fa-edit"></i> ç¼–è¾‘è¡¨å¤´
                </button>
            </div>
        </div>
        
        <div class="permission-hint" id="permissionHint" style="display: flex;">
            <i class="fas fa-info-circle"></i>
            <span>æ‚¨å½“å‰æ˜¯è®¿å®¢æ¨¡å¼ï¼Œåªèƒ½æŸ¥çœ‹æ•°æ®ã€‚è¯·ç™»å½•ç®¡ç†å‘˜è´¦æˆ·ä»¥è¿›è¡Œæ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤æ“ä½œã€‚</span>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="8%" class="editable-header" data-field="id">
                            <span id="header-id">åºå·</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="18%" class="editable-header" data-field="category">
                            <span id="header-category">åˆ†ç±»</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="34%" class="editable-header" data-field="path">
                            <span id="header-path">é“¾æ¥åœ°å€</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="25%" class="editable-header" data-field="note">
                            <span id="header-note">å¤‡æ³¨</span>
                            <i class="fas fa-edit edit-icon"></i>
                        </th>
                        <th width="15%">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="stats">
            <div id="totalCount">æ€»è®¡: 0 ä¸ªé¡¹ç›®</div>
            <div id="filteredCount">æ˜¾ç¤º: 0 ä¸ªé¡¹ç›®</div>
            <div id="configVersion">é…ç½®ç‰ˆæœ¬: åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ·»åŠ æ–°æ¡ç›®</h3>
                <button class="close-btn" id="closeModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <input type="hidden" id="editId" value="">
                    <div class="form-group">
                        <label class="form-label" for="itemTitle">é¡µé¢æ ‡é¢˜</label>
                        <input type="text" class="form-control" id="itemTitle" placeholder="è¾“å…¥é¡µé¢æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemCategory">åˆ†ç±»</label>
                        <select class="form-select" id="itemCategory" required>
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è·¯å¾„ç±»å‹</label>
                        <div class="path-type-selector">
                            <button type="button" class="path-type-btn active" data-type="url">ç½‘é¡µURL</button>
                            <button type="button" class="path-type-btn" data-type="folder">æ–‡ä»¶å¤¹è·¯å¾„</button>
                        </div>
                        <input type="text" class="form-control" id="itemPath" placeholder="è¾“å…¥ç½‘é¡µURLåœ°å€" required>
                        <div class="path-example" id="pathExample">ä¾‹å¦‚: https://example.com/page</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemNote">å¤‡æ³¨</label>
                        <textarea class="form-control" id="itemNote" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn cancel-btn" id="cancelBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveItemBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="headersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç¼–è¾‘è¡¨å¤´åç§°</h3>
                <button class="close-btn" id="closeHeadersModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="headersForm">
                    <div class="form-group">
                        <label class="form-label" for="headerIdInput">åºå·åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerIdInput" placeholder="è¾“å…¥åºå·åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerCategoryInput">åˆ†ç±»åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerCategoryInput" placeholder="è¾“å…¥åˆ†ç±»åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerPathInput">é“¾æ¥åœ°å€åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerPathInput" placeholder="è¾“å…¥é“¾æ¥åœ°å€åˆ—åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="headerNoteInput">å¤‡æ³¨åˆ—åç§°</label>
                        <input type="text" class="form-control" id="headerNoteInput" placeholder="è¾“å…¥å¤‡æ³¨åˆ—åç§°">
                    </div>
                </form>
                <div class="permission-hint">
                    <i class="fas fa-info-circle"></i>
                    <span>ä¿®æ”¹è¡¨å¤´åç§°åï¼Œé¡µé¢æ˜¾ç¤ºä¼šç«‹å³æ›´æ–°ï¼ŒåŒæ—¶ä¼šä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä¸­ã€‚</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn cancel-btn" id="cancelHeadersBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveHeadersBtn">ä¿å­˜è¡¨å¤´</button>
                <button class="btn btn-success" id="resetHeadersBtn">é‡ç½®è¡¨å¤´</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥SheetJSåº“ç”¨äºå¤„ç†Excelæ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ç¤ºä¾‹æ•°æ® - å°†ä»GitHubé…ç½®åŠ è½½
        let tableData = [];
        
        // GitHubé…ç½®URL
        const GITHUB_OWNER = 'Cybereign';
        const GITHUB_REPO = 'securityconfig';
        const GITHUB_BRANCH = 'main';
        const GITHUB_CONFIG_URL = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/config.json`;
        const GITHUB_EXCEL_URL = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/table.xlsx`;
        
        // GitHub API ç«¯ç‚¹
        const GITHUB_API_BASE = 'https://api.github.com';
        const GITHUB_CONTENT_URL = `${GITHUB_API_BASE}/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents`;
        
        // ç”¨æˆ·è´¦æˆ·ä¿¡æ¯å’Œé…ç½®
        let adminAccounts = [];
        let appConfig = {};
        let categoryMap = {};
        let categoryList = [];

        // è¡¨å¤´é…ç½®
        let headerConfig = {
            id: 'åºå·',
            category: 'åˆ†ç±»',
            path: 'é“¾æ¥åœ°å€',
            note: 'å¤‡æ³¨'
        };

        // ä¿®å¤çš„GitHub API æœåŠ¡ - å¤„ç†SHAå†²çªé—®é¢˜
        class GitHubService {
            constructor(token) {
                this.token = token;
            }

            async getFileContent(filePath) {
                try {
                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}?ref=${GITHUB_BRANCH}`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        if (response.status === 404) {
                            // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›null
                            return null;
                        }
                        throw new Error(`è·å–æ–‡ä»¶å¤±è´¥: ${response.status}`);
                    }

                    const data = await response.json();
                    const content = atob(data.content);
                    return {
                        content: content,
                        sha: data.sha,
                        exists: true
                    };
                } catch (error) {
                    console.error('è·å–æ–‡ä»¶å†…å®¹å¤±è´¥:', error);
                    throw error;
                }
            }

            async updateFileContent(filePath, content, sha, commitMessage) {
                try {
                    const payload = {
                        message: commitMessage,
                        content: content,
                        branch: GITHUB_BRANCH
                    };

                    // åªæœ‰åœ¨æ–‡ä»¶å·²å­˜åœ¨æ—¶æ‰æä¾›SHA
                    if (sha) {
                        payload.sha = sha;
                    }

                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        
                        // å¤„ç†SHAä¸åŒ¹é…é”™è¯¯
                        if (response.status === 409) {
                            throw new Error(`æ–‡ä»¶ç‰ˆæœ¬å†²çªã€‚è¯·å…ˆç‚¹å‡»"ä¿®å¤Excelæ ¼å¼"æŒ‰é’®ï¼Œç„¶åé‡è¯•ã€‚`);
                        }
                        
                        throw new Error(`æ›´æ–°æ–‡ä»¶å¤±è´¥: ${response.status} - ${errorData.message}`);
                    }

                    const data = await response.json();
                    console.log('æ–‡ä»¶æ›´æ–°æˆåŠŸ:', data);
                    return data;
                } catch (error) {
                    console.error('æ›´æ–°æ–‡ä»¶å¤±è´¥:', error);
                    throw error;
                }
            }

            async checkAuth() {
                try {
                    const response = await fetch(`${GITHUB_API_BASE}/user`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error('GitHub è®¤è¯å¤±è´¥');
                    }

                    const userData = await response.json();
                    return {
                        authenticated: true,
                        username: userData.login
                    };
                } catch (error) {
                    return {
                        authenticated: false,
                        error: error.message
                    };
                }
            }

            // æ–°å¢ï¼šå¼ºåˆ¶åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå¿½ç•¥SHAå†²çªï¼‰
            async forceCreateFile(filePath, content, commitMessage) {
                try {
                    // å…ˆå°è¯•è·å–å½“å‰æ–‡ä»¶ä¿¡æ¯
                    let currentFile = null;
                    try {
                        currentFile = await this.getFileContent(filePath);
                    } catch (error) {
                        console.log('æ–‡ä»¶ä¸å­˜åœ¨æˆ–è·å–å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
                    }

                    const payload = {
                        message: commitMessage,
                        content: content,
                        branch: GITHUB_BRANCH
                    };

                    // å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œä½¿ç”¨æ­£ç¡®çš„SHA
                    if (currentFile && currentFile.exists) {
                        payload.sha = currentFile.sha;
                    }

                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        
                        // å¦‚æœä»ç„¶å†²çªï¼Œå°è¯•ä½¿ç”¨ç©ºSHAåˆ›å»ºæ–°æ–‡ä»¶
                        if (response.status === 409) {
                            console.log('æ–‡ä»¶å†²çªï¼Œå°è¯•å¼ºåˆ¶åˆ›å»ºæ–°æ–‡ä»¶...');
                            return await this.forceCreateNewFile(filePath, content, commitMessage);
                        }
                        
                        throw new Error(`å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶å¤±è´¥: ${response.status} - ${errorData.message}`);
                    }

                    const data = await response.json();
                    console.log('æ–‡ä»¶å¼ºåˆ¶åˆ›å»ºæˆåŠŸ:', data);
                    return data;
                } catch (error) {
                    console.error('å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶å¤±è´¥:', error);
                    throw error;
                }
            }

            // å¼ºåˆ¶åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå¿½ç•¥ç°æœ‰æ–‡ä»¶ï¼‰
            async forceCreateNewFile(filePath, content, commitMessage) {
                try {
                    // ç›´æ¥åˆ›å»ºæ–°æ–‡ä»¶ï¼Œä¸æä¾›SHA
                    const payload = {
                        message: commitMessage,
                        content: content,
                        branch: GITHUB_BRANCH
                    };

                    const response = await fetch(`${GITHUB_CONTENT_URL}/${filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`åˆ›å»ºæ–°æ–‡ä»¶å¤±è´¥: ${response.status} - ${errorData.message}`);
                    }

                    const data = await response.json();
                    console.log('æ–°æ–‡ä»¶åˆ›å»ºæˆåŠŸ:', data);
                    return data;
                } catch (error) {
                    console.error('åˆ›å»ºæ–°æ–‡ä»¶å¤±è´¥:', error);
                    throw error;
                }
            }
        }

        // åˆ›å»º GitHub æœåŠ¡å®ä¾‹
        let gitHubService = null;

        // è‡ªåŠ¨ç™»å‡ºå’Œç™»å½•å°è¯•
        let logoutTimer;
        let loginAttempts = 0;

        // å½“å‰æ˜¾ç¤ºçš„æ•°æ®å’Œè·¯å¾„ç±»å‹
        let currentData = [];
        let currentPathType = 'url';
        let isLoggedIn = false;
        let currentUser = null;

        // DOMå…ƒç´ 
        const tableBody = document.getElementById('tableBody');
        const searchInput = document.getElementById('searchInput');
        const addBtn = document.getElementById('addBtn');
        const exportBtn = document.getElementById('exportBtn');
        const syncExcelBtn = document.getElementById('syncExcelBtn');
        const downloadExcelBtn = document.getElementById('downloadExcelBtn');
        const repairExcelBtn = document.getElementById('repairExcelBtn');
        const updateHTMLBtn = document.getElementById('updateHTMLBtn');
        const resetBtn = document.getElementById('resetBtn');
        const refreshConfigBtn = document.getElementById('refreshConfigBtn');
        const editHeadersBtn = document.getElementById('editHeadersBtn');
        const itemModal = document.getElementById('itemModal');
        const headersModal = document.getElementById('headersModal');
        const modalTitle = document.getElementById('modalTitle');
        const itemForm = document.getElementById('itemForm');
        const headersForm = document.getElementById('headersForm');
        const editId = document.getElementById('editId');
        const itemTitle = document.getElementById('itemTitle');
        const itemCategory = document.getElementById('itemCategory');
        const itemPath = document.getElementById('itemPath');
        const itemNote = document.getElementById('itemNote');
        const saveItemBtn = document.getElementById('saveItemBtn');
        const closeModal = document.getElementById('closeModal');
        const closeHeadersModal = document.getElementById('closeHeadersModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const cancelHeadersBtn = document.getElementById('cancelHeadersBtn');
        const saveHeadersBtn = document.getElementById('saveHeadersBtn');
        const resetHeadersBtn = document.getElementById('resetHeadersBtn');
        const totalCount = document.getElementById('totalCount');
        const filteredCount = document.getElementById('filteredCount');
        const pathTypeButtons = document.querySelectorAll('.path-type-btn');
        const pathExample = document.getElementById('pathExample');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginSection = document.getElementById('loginSection');
        const userSection = document.getElementById('userSection');
        const userName = document.getElementById('userName');
        const adminIndicator = document.getElementById('adminIndicator');
        const permissionHint = document.getElementById('permissionHint');
        const setupGitHubBtn = document.getElementById('setupGitHubBtn');

        // ========== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ==========

        // ä¼˜åŒ–åçš„ openFolder å‡½æ•°
        function openFolder(path) {
            const decodedPath = path.replace(/\\\\/g, '\\');
            
            console.log('åŸå§‹è·¯å¾„:', path);
            console.log('è§£ç è·¯å¾„:', decodedPath);
            console.log('å½“å‰ç¯å¢ƒåè®®:', window.location.protocol);
            
            // æ™ºèƒ½ç¯å¢ƒæ£€æµ‹
            if (isLocalEnvironment()) {
                // æœ¬åœ°ç¯å¢ƒï¼šå°è¯•ç›´æ¥æ‰“å¼€
                attemptDirectOpen(decodedPath);
            } else {
                // ç½‘ç»œç¯å¢ƒï¼šä½¿ç”¨å¤åˆ¶æ–¹æ¡ˆ
                offerPathCopy(decodedPath, 'ç”±äºç½‘é¡µå®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥æ‰“å¼€æœ¬åœ°æ–‡ä»¶å¤¹ã€‚');
            }
            
            return false;
        }

        // æ£€æµ‹æ˜¯å¦ä¸ºæœ¬åœ°ç¯å¢ƒ
        function isLocalEnvironment() {
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            
            // æœ¬åœ°æ–‡ä»¶åè®®
            if (protocol === 'file:') {
                return true;
            }
            
            // localhost æˆ–æœ¬åœ° IP
            if (hostname === 'localhost' || hostname === '127.0.0.1' || hostname === '::1') {
                return true;
            }
            
            // æœ¬åœ°ç½‘ç»œ IP (192.168.x.x, 10.x.x.x, 172.16.x.x - 172.31.x.x)
            if (/^(192\.168|10|172\.(1[6-9]|2[0-9]|3[0-1]))\./.test(hostname)) {
                return true;
            }
            
            return false;
        }

        // å°è¯•ç›´æ¥æ‰“å¼€æ–‡ä»¶å¤¹
        function attemptDirectOpen(decodedPath) {
            const fileUrl = `file:///${decodedPath.replace(/\\/g, '/')}`;
            
            console.log('å°è¯•ç›´æ¥æ‰“å¼€ File URL:', fileUrl);
            
            // æ–¹æ³•1: ä½¿ç”¨ window.open
            try {
                const newWindow = window.open(fileUrl, '_blank');
                
                // æ£€æŸ¥æ˜¯å¦æ‰“å¼€æˆåŠŸï¼ˆæŸäº›æµè§ˆå™¨ä¼šè¿”å› null å¦‚æœè¢«é˜»æ­¢ï¼‰
                if (newWindow === null || newWindow.closed) {
                    throw new Error('çª—å£æ‰“å¼€è¢«é˜»æ­¢');
                }
                
                showToast('æ­£åœ¨æ‰“å¼€æ–‡ä»¶å¤¹...', 'info');
                return true;
            } catch (error) {
                console.log('æ–¹æ³•1å¤±è´¥:', error.message);
            }
            
            // æ–¹æ³•2: ä½¿ç”¨ a æ ‡ç­¾ç‚¹å‡»
            try {
                const link = document.createElement('a');
                link.href = fileUrl;
                link.target = '_blank';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('æ­£åœ¨å°è¯•æ‰“å¼€æ–‡ä»¶å¤¹...', 'info');
                
                // å»¶è¿Ÿæ£€æŸ¥æ˜¯å¦çœŸçš„æ‰“å¼€äº†
                setTimeout(() => {
                    // å¦‚æœä»ç„¶éœ€è¦å¤åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥åœ¨è¿™é‡Œæä¾›
                    offerPathCopy(decodedPath, 'å¦‚æœæ–‡ä»¶å¤¹æ²¡æœ‰æ‰“å¼€ï¼Œè¯·ä½¿ç”¨å¤åˆ¶åŠŸèƒ½ï¼š');
                }, 1000);
                
                return true;
            } catch (error) {
                console.log('æ–¹æ³•2å¤±è´¥:', error.message);
            }
            
            // æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œé™çº§åˆ°å¤åˆ¶æ–¹æ¡ˆ
            console.log('æ‰€æœ‰ç›´æ¥æ‰“å¼€æ–¹æ³•éƒ½å¤±è´¥ï¼Œä½¿ç”¨å¤åˆ¶æ–¹æ¡ˆ');
            offerPathCopy(decodedPath, 'ç›´æ¥æ‰“å¼€å¤±è´¥ï¼Œè¯·ä½¿ç”¨å¤åˆ¶åŠŸèƒ½ï¼š');
            return false;
        }

        // æä¾›è·¯å¾„å¤åˆ¶åŠŸèƒ½
        function offerPathCopy(decodedPath, reason = '') {
            const message = reason + '\n\næ˜¯å¦å°†ä»¥ä¸‹è·¯å¾„å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Ÿ\n\nè·¯å¾„: ' + decodedPath;
            
            if (confirm(message)) {
                copyToClipboard(decodedPath).then(() => {
                    showToast('âœ… è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(err => {
                    // å¤‡ç”¨å¤åˆ¶æ–¹æ¡ˆ
                    fallbackCopy(decodedPath);
                });
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        async function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(text);
                return true;
            } else {
                // é™çº§æ–¹æ¡ˆ
                return fallbackCopy(text);
            }
        }

        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopy(text) {
            return new Promise((resolve, reject) => {
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    textArea.style.left = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    textArea.setSelectionRange(0, 99999); // ç§»åŠ¨è®¾å¤‡æ”¯æŒ
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        resolve(true);
                    } else {
                        reject(new Error('å¤åˆ¶å‘½ä»¤å¤±è´¥'));
                    }
                } catch (err) {
                    reject(err);
                }
            });
        }

        // æ˜¾ç¤º Toast æ¶ˆæ¯
        function showToast(message, type = 'info') {
            // ç§»é™¤ç°æœ‰çš„ toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas ${getToastIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // æ·»åŠ åŠ¨ç”»
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) toast.remove();
                }, 300);
            }, 3000);
        }

        function getToastIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            return icons[type] || 'fa-info-circle';
        }

        // SHA-256å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const msgString = String(message);
            const encoder = new TextEncoder();
            const data = encoder.encode(msgString);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // ä»GitHubåŠ è½½é…ç½®å’ŒExcelè¡¨æ ¼æ•°æ®
        async function loadConfigFromGitHub() {
            showLoadingIndicator('æ­£åœ¨ä»GitHubåŠ è½½é…ç½®...');
            
            try {
                const configResponse = await fetch(GITHUB_CONFIG_URL);
                if (!configResponse.ok) {
                    throw new Error(`é…ç½®åŠ è½½å¤±è´¥: HTTP ${configResponse.status}`);
                }
                const config = await configResponse.json();
                
                const excelResponse = await fetch(GITHUB_EXCEL_URL);
                if (!excelResponse.ok) {
                    throw new Error(`Excelè¡¨æ ¼åŠ è½½å¤±è´¥: HTTP ${excelResponse.status}`);
                }
                
                const arrayBuffer = await excelResponse.arrayBuffer();
                await processExcelData(arrayBuffer);
                
                adminAccounts = config.users || [];
                appConfig = config.settings || {};
                
                // ä¿®å¤ï¼šæ›´æ–°é…ç½®ç‰ˆæœ¬æ˜¾ç¤º
                updateConfigVersionInfo(config);
                
                console.log('âœ… GitHubé…ç½®å’ŒExcelè¡¨æ ¼æ•°æ®åŠ è½½æˆåŠŸ');
                hideLoadingIndicator();
                return true;
                
            } catch (error) {
                console.error('âŒ é…ç½®åŠ è½½å¤±è´¥:', error);
                showErrorMessage(`é…ç½®åŠ è½½å¤±è´¥: ${error.message}ï¼Œä½¿ç”¨é»˜è®¤é…ç½®`);
                useDefaultConfig();
                hideLoadingIndicator();
                return false;
            }
        }

        // å¤„ç†Excelæ•°æ®
        async function processExcelData(arrayBuffer) {
            try {
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { 
                    type: 'array',
                    cellText: false,
                    cellDates: true,
                    raw: false
                });
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                const excelData = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1,
                    defval: '',
                    blankrows: false
                });
                
                if (excelData.length < 2) {
                    throw new Error('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                }
                
                const headers = excelData[0];
                console.log('Excelè¡¨å¤´ç»“æ„:', headers);
                
                tableData = [];
                categoryMap = {};
                categoryList = [];
                const uniqueCategories = new Map();
                
                for (let i = 1; i < excelData.length; i++) {
                    const row = excelData[i];
                    if (row.length === 0 || !row.some(cell => cell !== '' && cell != null)) continue;
                    
                    const item = {
                        id: parseInt(row[0]) || i,
                        category: String(row[1] || '').trim(),
                        title: String(row[2] || '').trim(),
                        path: String(row[3] || '').trim(),
                        type: String(row[4] || 'url').toLowerCase().trim(),
                        note: String(row[5] || '').trim()
                    };
                    
                    if (!item.title && !item.path) continue;
                    
                    tableData.push(item);
                    
                    if (item.category && !uniqueCategories.has(item.category)) {
                        const categoryId = `category${uniqueCategories.size + 1}`;
                        uniqueCategories.set(item.category, {
                            id: categoryId,
                            name: item.category
                        });
                    }
                }
                
                categoryList = Array.from(uniqueCategories.values());
                categoryList.forEach(category => {
                    categoryMap[category.id] = category.name;
                });
                
                console.log('å¤„ç†åçš„æ•°æ®:', tableData);
                console.log('å»é‡åçš„åˆ†ç±»åˆ—è¡¨:', categoryList);
                
                updateCategoryFilters();
                renderTable(tableData);
                updateStats();
                
            } catch (error) {
                console.error('Excelæ•°æ®å¤„ç†å¤±è´¥:', error);
                throw new Error(`Excelæ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`);
            }
        }

        // åˆ›å»ºåˆ†ç±»é¢œè‰²æ˜ å°„å‡½æ•°
        function createCategoryColorMap() {
            const colorMap = {};
            const uniqueCategories = [...new Set(tableData.map(item => item.category).filter(Boolean))];
            
            uniqueCategories.forEach(category => {
                // ä½¿ç”¨åˆ†ç±»åç§°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ç æ¥è®¡ç®—é¢œè‰²
                const charCode = category.charCodeAt(0) || 0;
                const colorIndex = (charCode % 10) + 1; // 1-10
                colorMap[category] = `category-${colorIndex}`;
            });
            
            return colorMap;
        }

        // æ¸²æŸ“è¡¨æ ¼ - ä¿®å¤ç‰ˆæœ¬ï¼ˆç›¸åŒåˆ†ç±»ç›¸åŒé¢œè‰²ï¼‰
        function renderTable(data) {
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="empty-row">æœªæ‰¾åˆ°åŒ¹é…çš„é¡µé¢</td></tr>`;
                return;
            }
            
            // åˆ›å»ºåˆ†ç±»é¢œè‰²æ˜ å°„
            const categoryColorMap = createCategoryColorMap();
            
            tableBody.innerHTML = data.map(item => {
                const isUrl = item.type === 'url';
                const linkClass = isUrl ? 'link' : 'link folder-link';
                const iconClass = isUrl ? 'fas fa-external-link-alt' : 'fas fa-folder-open';
                const badgeClass = isUrl ? 'badge-url' : 'badge-folder';
                const badgeText = isUrl ? 'ç½‘é¡µ' : 'æ–‡ä»¶å¤¹';
                const categoryName = item.category || `åˆ†ç±»${item.id}`;
                
                // ä¿®å¤ï¼šä½¿ç”¨åˆ†ç±»åç§°è®¡ç®—é¢œè‰²ï¼Œç¡®ä¿ç›¸åŒåˆ†ç±»é¢œè‰²ä¸€è‡´
                const categoryClass = categoryColorMap[categoryName] || 'category-1';
                
                if (isUrl) {
                    return `
                    <tr>
                        <td>${item.id}</td>
                        <td><span class="category ${categoryClass}">${categoryName}</span></td>
                        <td>
                            <a href="${item.path}" target="_blank" class="${linkClass}">
                                <i class="${iconClass} link-icon"></i> 
                                ${item.title}
                                <span class="path-type-badge ${badgeClass}">${badgeText}</span>
                            </a>
                            <div class="path-display">${item.path}</div>
                        </td>
                        <td class="note">${item.note}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    `;
                } else {
                    return `
                    <tr>
                        <td>${item.id}</td>
                        <td><span class="category ${categoryClass}">${categoryName}</span></td>
                        <td>
                            <a href="#" class="${linkClass}" onclick="return openFolder('${item.path.replace(/\\/g, '\\\\')}')">
                                <i class="${iconClass} link-icon"></i> 
                                ${item.title}
                                <span class="path-type-badge ${badgeClass}">${badgeText}</span>
                            </a>
                            <div class="path-display">${item.path}</div>
                        </td>
                        <td class="note">${item.note}</td>
                        <td class="action-cell">
                            <button class="action-btn edit-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${item.id}" ${isLoggedIn ? '' : 'disabled'}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    `;
                }
            }).join('');
            
            document.querySelectorAll('.edit-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        openModal(id);
                    });
                }
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        deleteItem(id);
                    });
                }
            });
            
            updateStats();
        }

        // ========== ä¿®å¤çš„ExcelåŒæ­¥åŠŸèƒ½ ==========

        // ä¿®å¤çš„ArrayBufferè½¬Base64å‡½æ•°
        function arrayBufferToBase64(buffer) {
            try {
                const bytes = new Uint8Array(buffer);
                let binary = '';
                for (let i = 0; i < bytes.byteLength; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return btoa(binary);
            } catch (error) {
                console.error('Base64è½¬æ¢å¤±è´¥:', error);
                throw new Error('æ–‡ä»¶ç¼–ç è½¬æ¢å¤±è´¥');
            }
        }

        // ä¿®å¤çš„ExcelåŒæ­¥åŠŸèƒ½ - åŒ…å«ç½‘é¡µæ›´æ–°
        async function syncDataToExcel() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }

            if (!gitHubService) {
                alert('è¯·å…ˆé…ç½® GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ');
                document.getElementById('githubToken').focus();
                return;
            }

            try {
                showLoadingIndicator('æ­£åœ¨åŒæ­¥æ•°æ®åˆ° GitHub Excel æ–‡ä»¶...');

                // 1. è·å–å½“å‰ Excel æ–‡ä»¶ä¿¡æ¯
                let fileInfo;
                try {
                    fileInfo = await gitHubService.getFileContent('table.xlsx');
                    if (!fileInfo) {
                        console.log('æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
                        fileInfo = { sha: null, exists: false };
                    }
                } catch (error) {
                    console.log('è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶:', error);
                    fileInfo = { sha: null, exists: false };
                }
                
                // 2. å‡†å¤‡æ•°æ®
                const headers = ['åºå·', 'åˆ†ç±»', 'æ ‡é¢˜', 'åœ°å€', 'åœ°å€ç±»å‹', 'å¤‡æ³¨'];
                const excelData = [headers];
                
                tableData.forEach(item => {
                    const row = [
                        item.id || '',
                        item.category || '',
                        item.title || '',
                        item.path || '',
                        item.type || 'url',
                        item.note || ''
                    ];
                    excelData.push(row);
                });

                // 3. åˆ›å»ºå·¥ä½œè¡¨
                const worksheet = XLSX.utils.aoa_to_sheet(excelData);
                
                // 4. è®¾ç½®åˆ—å®½
                const colWidths = [
                    { wch: 8 },   // åºå·
                    { wch: 15 },  // åˆ†ç±»
                    { wch: 30 },  // æ ‡é¢˜
                    { wch: 50 },  // åœ°å€
                    { wch: 12 },  // åœ°å€ç±»å‹
                    { wch: 25 }   // å¤‡æ³¨
                ];
                worksheet['!cols'] = colWidths;

                // 5. åˆ›å»ºå·¥ä½œç°¿
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'DH3é¡¹ç›®ç´¢å¼•è¡¨');
                
                // 6. ç”Ÿæˆ Excel æ–‡ä»¶
                const excelBuffer = XLSX.write(workbook, { 
                    bookType: 'xlsx', 
                    type: 'array',
                    bookSST: false
                });

                // 7. è½¬æ¢ä¸º base64
                const excelBase64 = arrayBufferToBase64(excelBuffer);

                // 8. ä¸Šä¼ åˆ° GitHub - ä½¿ç”¨å¼ºåˆ¶åˆ›å»ºæ–¹æ³•è§£å†³SHAå†²çª
                await gitHubService.forceCreateFile(
                    'table.xlsx',
                    excelBase64,
                    `è‡ªåŠ¨åŒæ­¥è¡¨æ ¼æ•°æ® - ${new Date().toLocaleString()} - å…±${tableData.length}æ¡è®°å½•`
                );

                hideLoadingIndicator();
                showToast('âœ… æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ° GitHub Excel æ–‡ä»¶ï¼', 'success');
                
                // ğŸ¯ ä¿®å¤ï¼šåŒæ­¥æˆåŠŸåæ›´æ–°ç½‘é¡µæ˜¾ç¤º
                const searchTerm = searchInput.value.toLowerCase();
                const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';
                filterTable(searchTerm, activeCategory);
                updateConfigVersionInfo(appConfig);
                
            } catch (error) {
                console.error('åŒæ­¥åˆ° Excel å¤±è´¥:', error);
                hideLoadingIndicator();
                
                if (error.message.includes('æ–‡ä»¶ç‰ˆæœ¬å†²çª')) {
                    showToast(`åŒæ­¥å¤±è´¥: ${error.message}\n\nè¯·å…ˆç‚¹å‡»"ä¿®å¤Excelæ ¼å¼"æŒ‰é’®ï¼Œç„¶åé‡è¯•åŒæ­¥ã€‚`, 'error');
                } else {
                    showToast(`åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // ä¿®å¤çš„ä¸‹è½½Excelæ–‡ä»¶åŠŸèƒ½
        function downloadExcel() {
            try {
                const headers = ['åºå·', 'åˆ†ç±»', 'æ ‡é¢˜', 'åœ°å€', 'åœ°å€ç±»å‹', 'å¤‡æ³¨'];
                const excelData = [headers];
                
                tableData.forEach(item => {
                    const row = [
                        item.id || '',
                        item.category || '',
                        item.title || '',
                        item.path || '',
                        item.type || 'url',
                        item.note || ''
                    ];
                    excelData.push(row);
                });

                const worksheet = XLSX.utils.aoa_to_sheet(excelData);
                const colWidths = [
                    { wch: 8 },   // åºå·
                    { wch: 15 },  // åˆ†ç±»
                    { wch: 30 },  // æ ‡é¢˜
                    { wch: 50 },  // åœ°å€
                    { wch: 12 },  // åœ°å€ç±»å‹
                    { wch: 25 }   // å¤‡æ³¨
                ];
                worksheet['!cols'] = colWidths;

                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'DH3é¡¹ç›®ç´¢å¼•è¡¨');
                XLSX.writeFile(workbook, 'DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨.xlsx');
                
                showToast('Excelæ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', 'success');
                
            } catch (error) {
                console.error('ä¸‹è½½Excelå¤±è´¥:', error);
                showToast('ä¸‹è½½Excelæ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ä¿®å¤Excelæ–‡ä»¶æ ¼å¼åŠŸèƒ½ - å¼ºåˆ¶è§£å†³SHAå†²çª
        async function repairExcelFormat() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }

            if (!gitHubService) {
                alert('è¯·å…ˆé…ç½® GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ');
                return;
            }

            try {
                showLoadingIndicator('æ­£åœ¨ä¿®å¤ Excel æ–‡ä»¶æ ¼å¼...');

                // åˆ›å»ºå…¨æ–°çš„Excelæ–‡ä»¶ç»“æ„
                const headers = ['åºå·', 'åˆ†ç±»', 'æ ‡é¢˜', 'åœ°å€', 'åœ°å€ç±»å‹', 'å¤‡æ³¨'];
                const excelData = [headers];
                
                // æ·»åŠ å½“å‰æ•°æ®
                tableData.forEach(item => {
                    const row = [
                        item.id || '',
                        item.category || '',
                        item.title || '',
                        item.path || '',
                        item.type || 'url',
                        item.note || ''
                    ];
                    excelData.push(row);
                });

                // åˆ›å»ºå·¥ä½œè¡¨
                const worksheet = XLSX.utils.aoa_to_sheet(excelData);
                
                // è®¾ç½®åˆ—å®½
                const colWidths = [
                    { wch: 8 },   // åºå·
                    { wch: 15 },  // åˆ†ç±»
                    { wch: 30 },  // æ ‡é¢˜
                    { wch: 50 },  // åœ°å€
                    { wch: 12 },  // åœ°å€ç±»å‹
                    { wch: 25 }   // å¤‡æ³¨
                ];
                worksheet['!cols'] = colWidths;

                // åˆ›å»ºå·¥ä½œç°¿
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'DH3é¡¹ç›®ç´¢å¼•è¡¨');
                
                // ç”Ÿæˆ Excel æ–‡ä»¶
                const excelBuffer = XLSX.write(workbook, { 
                    bookType: 'xlsx', 
                    type: 'array',
                    bookSST: false
                });

                // è½¬æ¢ä¸º base64
                const excelBase64 = arrayBufferToBase64(excelBuffer);

                // å¼ºåˆ¶åˆ›å»ºæ–°æ–‡ä»¶ï¼Œè§£å†³SHAå†²çª
                await gitHubService.forceCreateNewFile(
                    'table.xlsx',
                    excelBase64,
                    `ä¿®å¤Excelæ–‡ä»¶æ ¼å¼ - ${new Date().toLocaleString()}`
                );

                hideLoadingIndicator();
                showToast('âœ… Excelæ–‡ä»¶æ ¼å¼ä¿®å¤å®Œæˆï¼SHAå†²çªå·²è§£å†³ã€‚ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨åŒæ­¥åŠŸèƒ½ã€‚', 'success');
                
            } catch (error) {
                console.error('ä¿®å¤Excelæ ¼å¼å¤±è´¥:', error);
                hideLoadingIndicator();
                showToast(`ä¿®å¤å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ========== å…¶ä»–åŠŸèƒ½å‡½æ•° ==========

        // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨
        function updateCategoryFilters() {
            const filterBox = document.querySelector('.filter-box');
            const allButton = filterBox.querySelector('[data-category="all"]');
            filterBox.innerHTML = '';
            filterBox.appendChild(allButton);
            
            const addedCategories = new Set();
            categoryList.forEach(category => {
                if (!addedCategories.has(category.name)) {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-category', category.id);
                    button.textContent = category.name;
                    filterBox.appendChild(button);
                    addedCategories.add(category.name);
                }
            });
            
            setupFilterEvents();
        }

        // æ›´æ–°åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateCategorySelect() {
            const categorySelect = document.getElementById('itemCategory');
            categorySelect.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>';
            
            categoryList.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // ä½¿ç”¨é»˜è®¤é…ç½®
        function useDefaultConfig() {
            adminAccounts = [
                { 
                    username: 'admin', 
                    passwordHash: 'b107fce20b89ab22f4eb72843df4acc2628c88d38c54f56bdf3767f53238274f',
                    name: 'ç®¡ç†å‘˜',
                    permissions: ['read', 'write', 'delete', 'export', 'config']
                },
                { 
                    username: 'editor', 
                    passwordHash: 'b107fce20b89ab22f4eb72843df4acc2628c88d38c54f56bdf3767f53238274f',
                    name: 'ç¼–è¾‘å‘˜',
                    permissions: ['read', 'write', 'export']
                }
            ];
            
            appConfig = {
                autoLogout: 60,
                maxLoginAttempts: 5,
                version: '1.0.0-default',
                lastUpdated: new Date().toISOString().split('T')[0]
            };
            
            tableData = [
                {
                    "id": 1,
                    "category": "å¼€å‘è®¡åˆ’",
                    "title": "DH3é¡¹ç›®å¼€å‘è®¡åˆ’",
                    "path": "https://example.com/development-plan",
                    "type": "url",
                    "note": "é¡¹ç›®æ•´ä½“å¼€å‘è®¡åˆ’å’Œæ—¶é—´å®‰æ’"
                },
                {
                    "id": 2,
                    "category": "è®¾è®¡è¯„å®¡",
                    "title": "ç³»ç»Ÿæ¶æ„è®¾è®¡è¯„å®¡",
                    "path": "\\\\10.4.9.25\\Project\\DHç³»åˆ—\\060-æ•´è½¦å¼€å‘\\DH3\\J2è¯„å®¡è¾“å…¥",
                    "type": "folder",
                    "note": "ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£å’Œè¯„å®¡è®°å½•"
                },
                {
                    "id": 3,
                    "category": "é˜¶æ®µè¯„å®¡",
                    "title": "ç¬¬ä¸€é˜¶æ®µäº¤ä»˜è¯„å®¡",
                    "path": "https://example.com/phase-review",
                    "type": "url",
                    "note": "ç¬¬ä¸€é˜¶æ®µæˆæœäº¤ä»˜å’Œè¯„å®¡ææ–™"
                }
            ];
            
            categoryList = [
                { id: "category1", name: "å¼€å‘è®¡åˆ’" },
                { id: "category2", name: "è®¾è®¡è¯„å®¡" },
                { id: "category3", name: "é˜¶æ®µè¯„å®¡" }
            ];
            
            categoryMap = {
                "category1": "å¼€å‘è®¡åˆ’",
                "category2": "è®¾è®¡è¯„å®¡",
                "category3": "é˜¶æ®µè¯„å®¡"
            };
            
            // ä¿®å¤ï¼šæ›´æ–°é»˜è®¤é…ç½®çš„ç‰ˆæœ¬ä¿¡æ¯
            updateConfigVersionInfo(appConfig);
            
            updateCategoryFilters();
            updateCategorySelect();
            renderTable(tableData);
            updateStats();
        }

        // æ›´æ–°é…ç½®ç‰ˆæœ¬ä¿¡æ¯å‡½æ•°
        function updateConfigVersionInfo(config) {
            const configVersionElement = document.getElementById('configVersion');
            if (!configVersionElement) return;
            
            const version = config.version || '1.0.0';
            const dataCount = tableData.length;
            const currentTime = new Date().toLocaleString();
            
            configVersionElement.textContent = `é…ç½®ç‰ˆæœ¬: ${version} | æ•°æ®é‡: ${dataCount}æ¡ | åŠ è½½æ—¶é—´: ${currentTime}`;
        }

        // æ•°æ®æŒä¹…åŒ–å‡½æ•°
        function saveDataToStorage() {
            localStorage.setItem('h5IndexData', JSON.stringify(tableData));
        }

        function loadDataFromStorage() {
            const savedData = localStorage.getItem('h5IndexData');
            if (savedData) {
                return JSON.parse(savedData);
            }
            return null;
        }

        // è¡¨å¤´é…ç½®æŒä¹…åŒ–
        function saveHeadersToStorage() {
            localStorage.setItem('h5IndexHeaders', JSON.stringify(headerConfig));
        }

        function loadHeadersFromStorage() {
            const savedHeaders = localStorage.getItem('h5IndexHeaders');
            if (savedHeaders) {
                return JSON.parse(savedHeaders);
            }
            return null;
        }

        // è®¾ç½®è‡ªåŠ¨ç™»å‡º
        function setupAutoLogout() {
            if (logoutTimer) {
                clearTimeout(logoutTimer);
            }
            
            const autoLogoutMinutes = appConfig.autoLogout || 60;
            
            logoutTimer = setTimeout(() => {
                if (isLoggedIn) {
                    alert(`ç”±äºé•¿æ—¶é—´æœªæ“ä½œï¼Œç³»ç»Ÿå·²è‡ªåŠ¨ç™»å‡ºã€‚è‡ªåŠ¨ç™»å‡ºæ—¶é—´ï¼š${autoLogoutMinutes}åˆ†é’Ÿ`);
                    handleLogout();
                }
            }, autoLogoutMinutes * 60 * 1000);
        }

        // é‡ç½®è‡ªåŠ¨ç™»å‡ºè®¡æ—¶å™¨
        function resetAutoLogoutTimer() {
            if (isLoggedIn) {
                setupAutoLogout();
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            // åŠ è½½è¡¨å¤´é…ç½®
            const savedHeaders = loadHeadersFromStorage();
            if (savedHeaders) {
                headerConfig = savedHeaders;
            }
            updateTableHeaders();

            // åŠ è½½ä¿å­˜çš„ GitHub ä»¤ç‰Œ
            loadGitHubToken();

            // è®¾ç½®é»˜è®¤é…ç½®ç‰ˆæœ¬æ˜¾ç¤ºï¼ˆåœ¨åŠ è½½å‰æ˜¾ç¤ºï¼‰
            document.getElementById('configVersion').textContent = 'é…ç½®ç‰ˆæœ¬: åŠ è½½ä¸­...';

            // ä»GitHubåŠ è½½é…ç½®
            await loadConfigFromGitHub();
            
            // åŠ è½½æœ¬åœ°æ•°æ®
            const savedData = loadDataFromStorage();
            if (savedData && savedData.length > 0) {
                tableData = savedData;
                currentData = [...tableData];
                renderTable(currentData);
                updateStats();
            }
            
            setupEventListeners();
            checkLoginStatus();
            updateCategorySelect();
            
            // è®¾ç½®æŒ‰é’®åˆå§‹æ˜¾ç¤ºçŠ¶æ€
            updateButtonVisibility();
            
            // è®¾ç½®ç”¨æˆ·æ´»åŠ¨ç›‘å¬å™¨
            document.addEventListener('click', resetAutoLogoutTimer);
            document.addEventListener('keypress', resetAutoLogoutTimer);
            document.addEventListener('mousemove', resetAutoLogoutTimer);
        });

        // æ›´æ–°è¡¨æ ¼è¡¨å¤´æ˜¾ç¤º
        function updateTableHeaders() {
            document.getElementById('header-id').textContent = headerConfig.id;
            document.getElementById('header-category').textContent = headerConfig.category;
            document.getElementById('header-path').textContent = headerConfig.path;
            document.getElementById('header-note').textContent = headerConfig.note;

            searchInput.placeholder = `æœç´¢é¡µé¢åç§°ã€${headerConfig.category.toLowerCase()}æˆ–${headerConfig.note.toLowerCase()}...`;
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('h5IndexCurrentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                loginSuccess(user);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æœç´¢åŠŸèƒ½
            searchInput.addEventListener('input', handleSearch);
            
            // è·¯å¾„ç±»å‹é€‰æ‹©
            pathTypeButtons.forEach(btn => {
                btn.addEventListener('click', handlePathTypeChange);
            });
            
            // æ·»åŠ æ–°æ¡ç›®
            addBtn.addEventListener('click', () => openModal());
            
            // å¯¼å‡ºæ•°æ®
            exportBtn.addEventListener('click', exportData);
            
            // åŒæ­¥åˆ° Excel
            syncExcelBtn.addEventListener('click', syncDataToExcel);
            
            // ä¸‹è½½ Excel
            downloadExcelBtn.addEventListener('click', downloadExcel);
            
            // ä¿®å¤Excelæ ¼å¼
            repairExcelBtn.addEventListener('click', repairExcelFormat);
            
            // æ›´æ–°HTML
            updateHTMLBtn.addEventListener('click', downloadUpdatedHTML);
            
            // é‡ç½®æ•°æ®
            resetBtn.addEventListener('click', resetData);
            
            // åˆ·æ–°é…ç½®
            refreshConfigBtn.addEventListener('click', refreshConfig);
            
            // ç¼–è¾‘è¡¨å¤´
            editHeadersBtn.addEventListener('click', openHeadersModal);
            
            // GitHub é…ç½®
            setupGitHubBtn.addEventListener('click', setupGitHubSync);
            
            // æ¨¡æ€æ¡†æ§åˆ¶
            closeModal.addEventListener('click', closeModalFunc);
            closeHeadersModal.addEventListener('click', closeHeadersModalFunc);
            cancelBtn.addEventListener('click', closeModalFunc);
            cancelHeadersBtn.addEventListener('click', closeHeadersModalFunc);
            saveItemBtn.addEventListener('click', saveItem);
            saveHeadersBtn.addEventListener('click', saveHeaders);
            resetHeadersBtn.addEventListener('click', resetHeaders);
            
            // ç™»å½•/ç™»å‡º
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', (e) => {
                if (e.target === itemModal) {
                    closeModalFunc();
                }
                if (e.target === headersModal) {
                    closeHeadersModalFunc();
                }
            });
            
            // å›è½¦ç™»å½•
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });

            // è¡¨å¤´ç‚¹å‡»ç¼–è¾‘
            setupHeaderEditListeners();
        }

        // è®¾ç½®è¡¨å¤´ç¼–è¾‘äº‹ä»¶
        function setupHeaderEditListeners() {
            const editableHeaders = document.querySelectorAll('.editable-header');
            editableHeaders.forEach(header => {
                header.addEventListener('click', (e) => {
                    if (isLoggedIn && currentUser && currentUser.permissions.includes('config')) {
                        editHeader(e.currentTarget);
                    }
                });
            });
        }

        // ç¼–è¾‘å•ä¸ªè¡¨å¤´
        function editHeader(headerElement) {
            const field = headerElement.dataset.field;
            const currentText = headerElement.querySelector('span').textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'header-edit-input';
            input.value = currentText;
            
            headerElement.style.position = 'relative';
            headerElement.appendChild(input);
            input.focus();
            input.select();
            
            const saveEdit = () => {
                const newValue = input.value.trim();
                if (newValue && newValue !== currentText) {
                    headerConfig[field] = newValue;
                    saveHeadersToStorage();
                    updateTableHeaders();
                }
                headerElement.removeChild(input);
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                }
                if (e.key === 'Escape') {
                    headerElement.removeChild(input);
                }
            });
        }

        // è®¾ç½®ç­›é€‰äº‹ä»¶
        function setupFilterEvents() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', handleFilter);
            });
        }

        // å¤„ç†è·¯å¾„ç±»å‹å˜åŒ–
        function handlePathTypeChange(e) {
            pathTypeButtons.forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            currentPathType = e.currentTarget.dataset.type;
            
            if (currentPathType === 'url') {
                pathExample.textContent = 'ä¾‹å¦‚: https://example.com/page';
                itemPath.placeholder = 'è¾“å…¥ç½‘é¡µURLåœ°å€';
            } else {
                pathExample.textContent = 'ä¾‹å¦‚: \\\\10.4.9.25\\Project\\æ–‡ä»¶å¤¹ æˆ– D:\\Projects\\æ–‡ä»¶å¤¹';
                itemPath.placeholder = 'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„';
            }
        }

        // å¤„ç†æœç´¢
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';
            filterTable(searchTerm, activeCategory);
        }

        // å¤„ç†ç­›é€‰
        function handleFilter(e) {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            
            const searchTerm = searchInput.value.toLowerCase();
            const category = e.currentTarget.dataset.category;
            filterTable(searchTerm, category);
        }

        // ç­›é€‰è¡¨æ ¼æ•°æ®
        function filterTable(searchTerm, category) {
            let filteredData = tableData;
            
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.title.toLowerCase().includes(searchTerm) || 
                    (item.category || '').toLowerCase().includes(searchTerm) ||
                    item.note.toLowerCase().includes(searchTerm) ||
                    item.path.toLowerCase().includes(searchTerm)
                );
            }
            
            if (category !== 'all') {
                const selectedCategory = categoryList.find(cat => cat.id === category);
                if (selectedCategory) {
                    filteredData = filteredData.filter(item => item.category === selectedCategory.name);
                }
            }
            
            currentData = filteredData;
            renderTable(currentData);
            updateStats();
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(id = null) {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (id) {
                const item = tableData.find(item => item.id === id);
                if (item) {
                    modalTitle.textContent = 'ç¼–è¾‘æ¡ç›®';
                    editId.value = item.id;
                    itemTitle.value = item.title;
                    const categoryEntry = Object.entries(categoryMap).find(([id, name]) => name === item.category);
                    itemCategory.value = categoryEntry ? categoryEntry[0] : '';
                    itemPath.value = item.path;
                    itemNote.value = item.note;
                    
                    currentPathType = item.type;
                    pathTypeButtons.forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.type === item.type);
                    });
                    updatePathExample();
                }
            } else {
                modalTitle.textContent = 'æ·»åŠ æ–°æ¡ç›®';
                itemForm.reset();
                editId.value = '';
                
                currentPathType = 'url';
                pathTypeButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.type === 'url');
                });
                updatePathExample();
            }
            
            itemModal.style.display = 'flex';
        }

        // æ›´æ–°è·¯å¾„ç¤ºä¾‹
        function updatePathExample() {
            if (currentPathType === 'url') {
                pathExample.textContent = 'ä¾‹å¦‚: https://example.com/page';
                itemPath.placeholder = 'è¾“å…¥ç½‘é¡µURLåœ°å€';
            } else {
                pathExample.textContent = 'ä¾‹å¦‚: \\\\10.4.9.25\\Project\\æ–‡ä»¶å¤¹ æˆ– D:\\Projects\\æ–‡ä»¶å¤¹';
                itemPath.placeholder = 'è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„';
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModalFunc() {
            itemModal.style.display = 'none';
            itemForm.reset();
        }

        // ä¿å­˜æ¡ç›®
        function saveItem() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (!itemTitle.value.trim() || !itemCategory.value || !itemPath.value.trim()) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }
            
            const pathValue = itemPath.value.trim();
            let detectedType = currentPathType;
            
            if (pathValue.startsWith('http://') || pathValue.startsWith('https://')) {
                detectedType = 'url';
            } else if (pathValue.includes('\\\\') || pathValue.includes(':\\')) {
                detectedType = 'folder';
            }
            
            const id = editId.value ? parseInt(editId.value) : generateId();
            const selectedCategory = categoryList.find(cat => cat.id === itemCategory.value);
            const categoryName = selectedCategory ? selectedCategory.name : 'æœªåˆ†ç±»';
            
            const newItem = {
                id: id,
                category: categoryName,
                title: itemTitle.value.trim(),
                path: pathValue,
                type: detectedType,
                note: itemNote.value.trim()
            };
            
            if (editId.value) {
                const index = tableData.findIndex(item => item.id === id);
                if (index !== -1) {
                    tableData[index] = newItem;
                }
            } else {
                tableData.push(newItem);
                
                if (categoryName && !categoryList.find(cat => cat.name === categoryName)) {
                    const categoryId = `category${categoryList.length + 1}`;
                    const newCategory = {
                        id: categoryId,
                        name: categoryName
                    };
                    categoryList.push(newCategory);
                    categoryMap[categoryId] = categoryName;
                    updateCategoryFilters();
                    updateCategorySelect();
                }
            }
            
            saveDataToStorage();
            
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
            filterTable(searchTerm, activeCategory);
            
            closeModalFunc();
        }

        // ç”Ÿæˆæ–°ID
        function generateId() {
            return tableData.length > 0 ? Math.max(...tableData.map(item => item.id)) + 1 : 1;
        }

        // åˆ é™¤æ¡ç›®
        function deleteItem(id) {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡ç›®å—ï¼Ÿ')) {
                tableData = tableData.filter(item => item.id !== id);
                saveDataToStorage();
                
                const searchTerm = searchInput.value.toLowerCase();
                const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
                filterTable(searchTerm, activeCategory);
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(tableData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'h5-index-data.json';
            link.click();
        }

        // æ‰“å¼€è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡†
        function openHeadersModal() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            document.getElementById('headerIdInput').value = headerConfig.id;
            document.getElementById('headerCategoryInput').value = headerConfig.category;
            document.getElementById('headerPathInput').value = headerConfig.path;
            document.getElementById('headerNoteInput').value = headerConfig.note;
            
            headersModal.style.display = 'flex';
        }

        // å…³é—­è¡¨å¤´ç¼–è¾‘æ¨¡æ€æ¡†
        function closeHeadersModalFunc() {
            headersModal.style.display = 'none';
        }

        // ä¿å­˜è¡¨å¤´é…ç½®
        function saveHeaders() {
            const newHeaders = {
                id: document.getElementById('headerIdInput').value.trim() || 'åºå·',
                category: document.getElementById('headerCategoryInput').value.trim() || 'åˆ†ç±»',
                path: document.getElementById('headerPathInput').value.trim() || 'é“¾æ¥åœ°å€',
                note: document.getElementById('headerNoteInput').value.trim() || 'å¤‡æ³¨'
            };
            
            headerConfig = newHeaders;
            saveHeadersToStorage();
            updateTableHeaders();
            closeHeadersModalFunc();
            alert('è¡¨å¤´åç§°å·²æ›´æ–°ï¼');
        }

        // é‡ç½®è¡¨å¤´é…ç½®
        function resetHeaders() {
            headerConfig = {
                id: 'åºå·',
                category: 'åˆ†ç±»',
                path: 'é“¾æ¥åœ°å€',
                note: 'å¤‡æ³¨'
            };
            saveHeadersToStorage();
            updateTableHeaders();
            closeHeadersModalFunc();
            alert('è¡¨å¤´åç§°å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼');
        }

        // åˆ·æ–°é…ç½®
        async function refreshConfig() {
            const success = await loadConfigFromGitHub();
            if (success) {
                alert('é…ç½®åˆ·æ–°æˆåŠŸï¼');
                if (isLoggedIn && currentUser) {
                    const updatedUser = adminAccounts.find(acc => acc.username === currentUser.username);
                    if (updatedUser) {
                        currentUser.permissions = updatedUser.permissions;
                        updateUIForPermissions();
                        updateButtonVisibility();
                    }
                }
            }
        }

        // æ ¹æ®æƒé™æ›´æ–°UI
        function updateUIForPermissions() {
            if (!currentUser) return;
            
            const canWrite = currentUser.permissions.includes('write');
            const canDelete = currentUser.permissions.includes('delete');
            const canExport = currentUser.permissions.includes('export');
            const canConfig = currentUser.permissions.includes('config');
            
            addBtn.disabled = !canWrite;
            resetBtn.disabled = !canDelete;
            exportBtn.disabled = !canExport;
            syncExcelBtn.disabled = !canExport;
            repairExcelBtn.disabled = !canExport;
            updateHTMLBtn.disabled = !canExport;
            editHeadersBtn.disabled = !canConfig;
            
            const editableHeaders = document.querySelectorAll('.editable-header');
            editableHeaders.forEach(header => {
                if (canConfig) {
                    header.style.cursor = 'pointer';
                } else {
                    header.style.cursor = 'default';
                }
            });
        }

        // æ ¹æ®æƒé™æ›´æ–°æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        function updateButtonVisibility() {
            if (!currentUser) {
                // æœªç™»å½•çŠ¶æ€ï¼Œåªæ˜¾ç¤ºä¸‹è½½Excelå’Œåˆ·æ–°é…ç½®æŒ‰é’®
                addBtn.style.display = 'none';
                resetBtn.style.display = 'none';
                exportBtn.style.display = 'none';
                syncExcelBtn.style.display = 'none';
                repairExcelBtn.style.display = 'none';
                updateHTMLBtn.style.display = 'none';
                editHeadersBtn.style.display = 'none';
                downloadExcelBtn.style.display = 'flex';
                refreshConfigBtn.style.display = 'flex';
                return;
            }
            
            const canWrite = currentUser.permissions.includes('write');
            const canDelete = currentUser.permissions.includes('delete');
            const canExport = currentUser.permissions.includes('export');
            const canConfig = currentUser.permissions.includes('config');
            
            // æ˜¾ç¤º/éšè—æŒ‰é’®
            addBtn.style.display = canWrite ? 'flex' : 'none';
            resetBtn.style.display = canDelete ? 'flex' : 'none';
            exportBtn.style.display = canExport ? 'flex' : 'none';
            syncExcelBtn.style.display = canExport ? 'flex' : 'none';
            repairExcelBtn.style.display = canExport ? 'flex' : 'none';
            updateHTMLBtn.style.display = canExport ? 'flex' : 'none';
            editHeadersBtn.style.display = canConfig ? 'flex' : 'none';
            
            // ä¸‹è½½Excelå’Œåˆ·æ–°é…ç½®å¯¹æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è§
            downloadExcelBtn.style.display = 'flex';
            refreshConfigBtn.style.display = 'flex';
            
            // åŒæ—¶æ›´æ–°ç¦ç”¨çŠ¶æ€
            addBtn.disabled = !canWrite;
            resetBtn.disabled = !canDelete;
            exportBtn.disabled = !canExport;
            syncExcelBtn.disabled = !canExport;
            repairExcelBtn.disabled = !canExport;
            updateHTMLBtn.disabled = !canExport;
            editHeadersBtn.disabled = !canConfig;
        }

        // å¤„ç†ç™»å½•
        async function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            const maxAttempts = appConfig.maxLoginAttempts || 5;
            if (loginAttempts >= maxAttempts) {
                alert(`ç™»å½•å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•ã€‚æœ€å¤§å°è¯•æ¬¡æ•°ï¼š${maxAttempts}`);
                return;
            }
            
            const passwordHash = await sha256(password);
            const user = adminAccounts.find(acc => 
                acc.username === username && acc.passwordHash === passwordHash
            );
            
            if (user) {
                loginAttempts = 0;
                loginSuccess(user);
                localStorage.setItem('h5IndexCurrentUser', JSON.stringify({
                    username: user.username,
                    name: user.name,
                    permissions: user.permissions || ['read']
                }));
            } else {
                loginAttempts++;
                const remainingAttempts = maxAttempts - loginAttempts;
                alert(`ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°ï¼š${remainingAttempts}`);
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // ç™»å½•æˆåŠŸ - ä¿®å¤ç‰ˆæœ¬
        function loginSuccess(user) {
            isLoggedIn = true;
            currentUser = user;
            
            loginSection.style.display = 'none';
            userSection.style.display = 'block';
            userName.textContent = user.name;
            adminIndicator.style.display = 'flex';
            permissionHint.style.display = 'none';
            
            updateUIForPermissions();
            updateButtonVisibility();
            
            // ä¿®å¤ï¼šç™»å½•åé‡æ–°æ¸²æŸ“è¡¨æ ¼ï¼Œç¡®ä¿æ“ä½œæŒ‰é’®çŠ¶æ€æ­£ç¡®
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';
            filterTable(searchTerm, activeCategory);
            
            passwordInput.value = '';
            setupAutoLogout();
        }

        // å¤„ç†ç™»å‡º - ä¿®å¤ç‰ˆæœ¬
        function handleLogout() {
            isLoggedIn = false;
            currentUser = null;
            
            if (logoutTimer) {
                clearTimeout(logoutTimer);
                logoutTimer = null;
            }
            
            loginSection.style.display = 'block';
            userSection.style.display = 'none';
            adminIndicator.style.display = 'none';
            permissionHint.style.display = 'flex';
            
            // æ›´æ–°æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
            updateButtonVisibility();
            
            // ä¿®å¤ï¼šç™»å‡ºåé‡æ–°æ¸²æŸ“è¡¨æ ¼ï¼Œç¦ç”¨æ“ä½œæŒ‰é’®
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';
            filterTable(searchTerm, activeCategory);
            
            localStorage.removeItem('h5IndexCurrentUser');
            usernameInput.value = '';
            passwordInput.value = '';
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            totalCount.textContent = `æ€»è®¡: ${tableData.length} ä¸ªé¡¹ç›®`;
            filteredCount.textContent = `æ˜¾ç¤º: ${currentData.length} ä¸ªé¡¹ç›®`;
        }

        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoadingIndicator(message) {
            const indicator = document.getElementById('loadingIndicator');
            const text = indicator.querySelector('span');
            if (indicator) {
                text.textContent = message;
                indicator.style.display = 'flex';
            }
        }

        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            if (errorDiv && errorText) {
                errorText.textContent = message;
                errorDiv.style.display = 'flex';
            }
        }

        // GitHubç›¸å…³åŠŸèƒ½
        function showGitHubTokenHelp() {
            alert(`GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ - å®Œå…¨å…è´¹\n\n` +
                  `å¦‚ä½•è·å–ï¼š\n` +
                  `1. ç™»å½• GitHub â†’ Settings â†’ Developer settings\n` +
                  `2. é€‰æ‹© Personal access tokens â†’ Tokens (classic)\n` +
                  `3. ç‚¹å‡» Generate new token\n` +
                  `4. è®¾ç½®å¤‡æ³¨ï¼Œé€‰æ‹©è¿‡æœŸæ—¶é—´ï¼ˆå»ºè®®1å¹´ï¼‰\n` +
                  `5. å‹¾é€‰ repo æƒé™ï¼ˆå®Œæ•´æ§åˆ¶ç§æœ‰ä»“åº“ï¼‰\n` +
                  `6. ç”Ÿæˆä»¤ç‰Œå¹¶å¤åˆ¶ä¿å­˜\n\n` +
                  `ğŸ’¡ é‡è¦æç¤ºï¼š\n` +
                  `â€¢ è¿™ä¸ªåŠŸèƒ½å®Œå…¨å…è´¹\n` +
                  `â€¢ ä¸ä¼šäº§ç”Ÿä»»ä½•è´¹ç”¨\n` +
                  `â€¢ ä»¤ç‰Œåªä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°\n` +
                  `â€¢ å¯ä»¥éšæ—¶åœ¨ GitHub ä¸Šæ’¤é”€ä»¤ç‰Œ`);
        }

        // é…ç½® GitHub åŒæ­¥
        async function setupGitHubSync() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                alert('è¯·è¾“å…¥ GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œ');
                return;
            }

            try {
                showLoadingIndicator('æ­£åœ¨éªŒè¯ GitHub ä»¤ç‰Œ...');
                gitHubService = new GitHubService(token);
                const authResult = await gitHubService.checkAuth();
                
                if (authResult.authenticated) {
                    localStorage.setItem('githubToken', token);
                    document.getElementById('githubToken').value = '';
                    document.getElementById('githubStatus').innerHTML = 
                        `<i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥ (${authResult.username})`;
                    
                    hideLoadingIndicator();
                    alert('GitHub ä»¤ç‰Œé…ç½®æˆåŠŸï¼ç°åœ¨å¯ä»¥åŒæ­¥æ•°æ®åˆ° Excel æ–‡ä»¶äº†ã€‚');
                } else {
                    throw new Error('GitHub ä»¤ç‰ŒéªŒè¯å¤±è´¥');
                }
                
            } catch (error) {
                console.error('GitHub é…ç½®å¤±è´¥:', error);
                hideLoadingIndicator();
                alert(`GitHub é…ç½®å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥ï¼š\n1. ä»¤ç‰Œæ˜¯å¦æ­£ç¡®\n2. ä»¤ç‰Œæ˜¯å¦å…·æœ‰ repo æƒé™\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸`);
            }
        }

        // åŠ è½½ä¿å­˜çš„ GitHub ä»¤ç‰Œ
        function loadGitHubToken() {
            const savedToken = localStorage.getItem('githubToken');
            if (savedToken) {
                gitHubService = new GitHubService(savedToken);
                gitHubService.checkAuth().then(authResult => {
                    if (authResult.authenticated) {
                        document.getElementById('githubStatus').innerHTML = 
                            `<i class="fas fa-check-circle"></i> GitHubå·²è¿æ¥ (${authResult.username})`;
                    } else {
                        localStorage.removeItem('githubToken');
                        gitHubService = null;
                    }
                });
            }
        }

        // ç”Ÿæˆå¹¶ä¸‹è½½æ›´æ–°åçš„HTMLæ–‡ä»¶
        function downloadUpdatedHTML() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            const updatedHTML = generateUpdatedHTML();
            const blob = new Blob([updatedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'DH3é¡¹ç›®HelpMeç´¢å¼•è¡¨_æ›´æ–°ç‰ˆ.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æ›´æ–°åçš„HTMLæ–‡ä»¶å·²ç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½ï¼');
        }

        // ç”ŸæˆåŒ…å«å½“å‰æ•°æ®çš„HTML
        function generateUpdatedHTML() {
            const currentHTML = document.documentElement.outerHTML;
            const dataRegex = /let tableData = \[[\s\S]*?\];/;
            const newDataDefinition = `let tableData = ${JSON.stringify(tableData, null, 8)};`;
            let updatedHTML = currentHTML.replace(dataRegex, newDataDefinition);
            
            const tableBodyRegex = /<tbody id="tableBody">[\s\S]*?<\/tbody>/;
            const emptyTableBody = `<tbody id="tableBody">\n                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->\n                </tbody>`;
            updatedHTML = updatedHTML.replace(tableBodyRegex, emptyTableBody);
            
            return updatedHTML;
        }

        // é‡ç½®æ•°æ®
        function resetData() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
                return;
            }
            
            if (confirm('ç¡®å®šè¦é‡ç½®æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æœ¬åœ°ä¿®æ”¹ï¼Œæ¢å¤ä¸ºGitHubé…ç½®çš„æ•°æ®ã€‚')) {
                loadConfigFromGitHub();
                localStorage.removeItem('h5IndexData');
                alert('æ•°æ®å·²é‡ç½®ä¸ºGitHubé…ç½®çš„åˆå§‹çŠ¶æ€');
            }
        }
    </script>
</body>
</html>
